---
id: maps-more,-objects-less
title: Maps More, Objects Less
description: JavaScript çš„ Object æ˜¯ä¸€å€‹å¼·å¤§çš„å·¥å…·ï¼Œä½†å®ƒä¸æ˜¯åœ¨æ‰€æœ‰å ´æ™¯éƒ½æ˜¯æœ€ä½³é¸æ“‡ã€‚é€™ç¯‡æ–‡ç« å°‡æ¢è¨å¦‚ä½•ä½¿ç”¨ Map ä¾†å–ä»£ Objectï¼Œä»¥åŠä½•æ™‚æ‡‰è©²ä½¿ç”¨å®ƒå€‘ã€‚
sidebar_label: ğŸŸ© Maps More, Objects Less
hide_title: true
hide_table_of_contents: false
tags: [javascript, typescript, object, map]
draft: false
last_updated: 2023-02-28
---

<profile
  title="Use Maps More and Objects Less"
  url="https://www.builder.io/blog/maps"
  author="STEVE SEWELL"
  level="beginner"
  category={["js/ts"]}
/>

JavaScript çš„ Object æ˜¯ä¸€å€‹å¼·å¤§çš„å·¥å…·ï¼Œä½†å®ƒä¸æ˜¯åœ¨æ‰€æœ‰å ´æ™¯éƒ½æ˜¯æœ€ä½³é¸æ“‡ã€‚é€™ç¯‡æ–‡ç« å°‡è¨è«–ä½¿ç”¨ Object æ™‚å¯èƒ½å‡ºç¾çš„å•é¡Œï¼Œä¸¦æ¢ç´¢åœ¨è¨±å¤šæƒ…æ³ä¸‹ Map æ˜¯æ›´å¥½çš„é¸æ“‡ã€‚

## Performance issues with Objects

ç¬¬ä¸€å€‹ Objects æœƒé‡åˆ°çš„å•é¡Œæ˜¯æ€§èƒ½ï¼Œä¾‹å¦‚ä½ å¯èƒ½æœƒé‡åˆ°ä½ çš„ Object å¸¸å¸¸è¢«ä¿®æ”¹ã€åˆªé™¤æˆ–æ–°å¢ã€‚é€™äº›æ“ä½œåœ¨ Map ä¸Šçš„æ•ˆèƒ½æœƒæ¯” Object å¥½å¾—å¾ˆå¤šï¼Œåœ¨ [MDN ä¸Šçš„ Performance æ¯”è¼ƒ](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map#objects_vs._maps:~:text=of%20an%20object.-,Performance,-Performs%20better%20in)ä¸­ä¹Ÿæœ‰æåˆ°ï¼ŒMap åœ¨é »ç¹æ–°å¢ã€åˆªé™¤ key-value pair æ™‚çš„æ•ˆèƒ½æœƒæ¯” Object å¥½å¾—å¤šã€‚

<div style={{ columns: "20rem" }}>

```js title="Object ğŸš©"
const mapOfThings = {};
mapOfThings[myThing.id] = myThing;
delete mapOfThings[myThing.id];
```

```js title="Map ğŸš€"
const mapOfThings = new Map();
mapOfThings.set(myThing.id, myThing);
mapOfThings.delete(myThing.id);
```

</div>

## Built-in Keys in Objects

ç¬¬äºŒå€‹ Object æœƒé‡åˆ°çš„å•é¡Œæ˜¯å®ƒçš„ key ä¸åªåŒ…å«è‡ªå®šç¾©çš„ keyï¼Œé‚„åŒ…å«äº†ä¸€äº›å…§å»ºçš„ keyï¼Œä¾‹å¦‚ `valueOf`ã€`constructor`ã€`toString` ç­‰ç­‰ã€‚é€™äº›å…§å»ºçš„ key æœƒå°è‡´ä¸€äº›å•é¡Œï¼Œä¾‹å¦‚ä½ çš„ key å€¼éå¸¸éš¨æ©Ÿï¼Œå¯èƒ½æœƒé€ æˆå…§å»ºçš„ key è¢«æ±™æŸ“ï¼Œè®“ä½ çš„ Object è®Šå¾—ä¸å¯é æ¸¬ã€‚

```js title="Polluted Object ğŸ˜±"
const obj = { a: 1 };
obj["toString"] = "my value";
// error-next-line
obj.toString(); // obj.toString is not a function
```

é€™äº›å…§å»ºçš„ keys ä¹Ÿæœƒåœ¨è¿­ä»£æ™‚é€ æˆå•é¡Œï¼Œä¾‹å¦‚ä»¥ä¸‹å…©ç¨®æ˜¯æ¯”è¼ƒå±éšªçš„æ–¹å¼è¿­ä»£ä¸€å€‹ Objectï¼š

```js title="Dangerous Object Iteration ğŸš©"
for (const key in myObject) {
  // ğŸš© å¯èƒ½æœƒé‡åˆ°ä¸€äº›ä½ æ²’æœ‰æƒ³è¦çš„ key
}

for (const key in myObject) {
  if (myObject.hasOwnProperty(key)) {
    // ğŸš© myObject.hasOwnProperty å¯èƒ½æœƒè¢«è¦†å¯«æˆä»»ä½•å…¶ä»–å€¼ã€‚
  }
}
```

ä½†æ˜¯ Map ä¸æœƒæœ‰é€™äº›å•é¡Œï¼Œåœ¨ Map ç›´æ¥ä½¿ç”¨æ¨™æº–çš„ `for...of` è¿­ä»£å°±å¯ä»¥ä¸€æ¬¡ç²å¾—æ‰€æœ‰çš„ key-value pairã€‚

```js title="Safe Map Iteration ğŸš€"
for (const [key, value] of myMap) {
  // ğŸš€ å®‰å…¨çš„ç²å¾—æ¯ä¸€å€‹ key-value pair
}

for (const value of myMap.values()) {
  // ğŸ™‚ ä½ å¯ä»¥åªç²å¾— value
}

for (const key of myMap.keys()) {
  // ğŸ™‚ ä½ å¯ä»¥åªç²å¾— key
}
```

å¦å¤–ï¼Œä½ ä¹Ÿå¯ä»¥å…ˆå°‡ Object é€é `Object.entries` è½‰æ›æˆä¸€å€‹äºŒç¶­é™£åˆ—ï¼Œå†ä½¿ç”¨ `for...of` è¿­ä»£ã€‚

```js title="Safe Object Iteration ğŸš€"
for (const [key, value] of Object.entries(myObject)) {
  // ğŸ™‚ å®‰å…¨çš„å¾ Object ç²å¾—æ¯ä¸€å€‹ key-value pair
}
```

## Key Ordering in Objects

ç¬¬ä¸‰å€‹ Object æœƒé‡åˆ°çš„å•é¡Œæ˜¯å®ƒçš„ key ä¸¦ä¸æœƒä¿æŒåŸæœ¬çš„é †åºï¼Œä½†æ˜¯åœ¨ Map ä¸­ key æœƒä¿æŒåŸæœ¬çš„é †åºã€‚ä¾‹å¦‚ä½ å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç²å¾—ä¸€å€‹ Map çš„ç¬¬ä¸€å€‹ key-value pairï¼š

```js title="Map First Key ğŸš€"
const myMap = new Map(Object.entries({ a: 1, b: 2, c: 3 }));
const [[firstKey, firstValue]] = myMap;
// firstKey === "a"
// firstValue === 1
```

## Key Types in Objects

ç¬¬å››å€‹ Object æœƒé‡åˆ°çš„å•é¡Œæ˜¯å®ƒçš„ key åªèƒ½æ˜¯å­—ä¸²ï¼Œä½†æ˜¯åœ¨ Map ä¸­ key å¯ä»¥æ˜¯ä»»ä½•å€¼ã€‚ä½ ç”šè‡³å¯ä»¥ä½¿ç”¨ä¸€å€‹ Object ä½œç‚º Map çš„ keyï¼é€™å€‹ç‰¹æ€§å¯ä»¥è®“ä½ åœ¨ Map ä¸­å„²å­˜ä»»ä½•å€¼ï¼Œä¾‹å¦‚ä½ å¯ä»¥å„²å­˜ä¸€å€‹ DOM å…ƒç´ çš„ç›¸é—œè³‡è¨Šï¼Œæˆ–æ˜¯å„²å­˜ä¸€å€‹å‡½å¼çš„ç›¸é—œè³‡è¨Šã€‚

<div style={{ columns: "20rem" }}>

```js title="Anything as Map Key ğŸš€"
myMap.set({}, value);
myMap.set([], value);
myMap.set(document.body, value);
myMap.set(function () {}, value);
myMap.set(myDog, value);
```

```js title="Store metadata of myTodo Object ğŸš€"
const metadata = new Map();
metadata.set(myTodo, {
  focused: true,
});
metadata.get(myTodo); // { focused: true }
```

</div>

:::warning
ä½†æ˜¯ï¼Œç”±æ–¼é€™å€‹ metadata Map ä¿æŒè‘—å° myTodo çš„å¼•ç”¨ï¼Œæ‰€ä»¥å°±ç®—ä½ ç§»é™¤äº† myTodoï¼Œé‚£éº¼ garbage collection ä¹Ÿä¸æœƒå°‡ metadata Map ä¸­çš„ myTodo ç§»é™¤ï¼Œé€ æˆ memory leakã€‚
:::

### WeakMap

å¦‚æœä½ æƒ³è¦åœ¨ Map ä¸­å„²å­˜ DOM å…ƒç´ æˆ–æ˜¯å…¶ä»–ç‰©ä»¶ï¼Œä½†åˆä¸æƒ³è¦é€ æˆ memory leakï¼Œé‚£éº¼ä½ å¯ä»¥ä½¿ç”¨ [WeakMap](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap)ã€‚WeakMap èˆ‡ Map çš„å·®åˆ¥åœ¨æ–¼ï¼Œå®ƒä¸æœƒä¿æŒå° key çš„å¼•ç”¨ï¼Œæ‰€ä»¥ç•¶ key è¢« garbage collection æ™‚ï¼ŒWeakMap ä¹Ÿæœƒè‡ªå‹•ç§»é™¤é€™å€‹ keyã€‚

```js title="WeakMap ğŸš€"
const metadata = new WeakMap();
// âœ… ä¸æœƒæœ‰ memory leakï¼Œç•¶ myTodo æ²’æœ‰è¢«å¼•ç”¨æ™‚ï¼Œå®ƒæœƒè¢«è‡ªå‹•ç§»é™¤
metadata.set(myTodo, {
  focused: true,
});
```

<divider />

åœ¨è¬›å®Œå››å€‹ Object æœƒé‡åˆ°çš„å•é¡Œä»¥åŠ Map çš„å„ªé»ä¹‹å¾Œï¼Œæˆ‘å€‘å†ä¾†çœ‹çœ‹å¦‚ä½•åœ¨ Map ä¸­å¯¦ç¾åƒ Object è¤‡è£½çš„åŠŸèƒ½ã€å¦‚ä½•å°‡ Object å’Œ Map äº’ç›¸è½‰æ›ï¼Œä»¥åŠåœ¨ä»€éº¼æƒ…æ³ä¸‹æ‡‰è©²ä½¿ç”¨ Object æˆ– Mapã€‚

## Copying

è¦è¤‡è£½ä¸€å€‹ Object å¾ˆç°¡å–®ï¼Œå¯ä»¥ä½¿ç”¨ `Object.assign` æˆ–æ˜¯å±•é–‹é‹ç®—å­ `...`ã€‚ä½†å…¶å¯¦è¤‡è£½ä¸€å€‹ Map ä¹Ÿä¸æœƒå¤šéº¼å›°é›£ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ `new Map` ä¾†è¤‡è£½ä¸€å€‹ Mapã€‚å¦å¤–ï¼Œå¦‚æœä½ æƒ³è¦æ·±åº¦è¤‡è£½ä¸€å€‹ Mapï¼Œä½ å¯ä»¥ä½¿ç”¨ [structuredClone](https://developer.mozilla.org/en-US/docs/Web/API/structuredClone) ä¾†åšåˆ°ã€‚

<div style={{ columns: "20rem" }}>

```js title="Copy An Object"
const myObjectCopy = { ...myObject };
const myObjectCopy = Object.assign({}, myObject);
```

```js title="Copy A Map"
const myMapCopy = new Map(myMap);
const deepCopy = structuredClone(myMap);
```

</div>

## Conversion

å¦‚æœä½ æƒ³è¦å°‡ä¸€å€‹ Object è½‰æ›æˆä¸€å€‹ Mapï¼Œä½ å¯ä»¥ä½¿ç”¨ `Object.entries` ä¾†å°‡ Object è½‰æ›æˆä¸€å€‹äºŒç¶­é™£åˆ—ï¼Œå†ä½¿ç”¨ `new Map` ä¾†å°‡äºŒç¶­é™£åˆ—è½‰æ›æˆä¸€å€‹ Mapã€‚

```js title="Convert Object to Map"
const myObject = { a: 1, b: 2, c: 3 };
const myEntries = Object.entries(myObject);
// myEntries === [["a", 1], ["b", 2], ["c", 3]]
const myMap = new Map(myEntries);
// myMap === Map { "a" => 1, "b" => 2, "c" => 3 }
```

å¦‚æœä½ æƒ³è¦å°‡ä¸€å€‹ Map è½‰æ›æˆä¸€å€‹ Object æ›´å®¹æ˜“ï¼Œå› ç‚º Map æœ¬èº«å°±æ˜¯ä¸€å€‹ entries çš„é›†åˆï¼Œä½ å¯ä»¥ä½¿ç”¨ `Object.fromEntries` ä¾†å°‡ Map è½‰æ›æˆä¸€å€‹ Objectã€‚

```js title="Convert Map to Object"
const myMap = new Map(Object.entries({ a: 1, b: 2, c: 3 }));
const myObject = Object.fromEntries(myMap);
// myObject === { a: 1, b: 2, c: 3 }
```

:::tip Helper Function
æˆ‘å€‘å¯ä»¥å°‡ Object è½‰æ›æˆ Map çš„å‡½å¼å¯«æˆä¸€å€‹ helper functionï¼Œé€™æ¨£ä¹‹å¾Œå°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„å°‡ Object è½‰æ›æˆ Map äº†ã€‚

```js title="Convert Object to Map Helper Function"
const makeMap = (obj) => new Map(Object.entries(obj));
const myMap = makeMap({ a: 1, b: 2, c: 3 });
```

å¯«æˆ TypeScript çš„è©±ï¼Œå¯ä»¥é€™æ¨£å¯«ï¼š

```ts title="Convert Object to Map Helper Function in TypeScript"
const makeMap = <V = unknown>(obj: Record<string, V>) =>
  new Map<string, V>(Object.entries(obj));
const myMap = makeMap({ a: 1, b: 2, c: 3 });
```

:::

## When to Use Object or Map

ç•¶ä½ çš„è³‡æ–™ç¸½æ˜¯æœ‰å›ºå®šçš„ key æ™‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ Objectï¼Œå› ç‚º Object åœ¨å›ºå®šçš„ key ä¸Šæœ‰è¼ƒå¥½çš„è®€å–æ•ˆèƒ½ã€‚

```js title="Object is faster when key is fixed"
// ç•¶ key æ˜¯å›ºå®šçš„æ™‚å€™ï¼ŒObject æœƒæ¯” Map å¿«
const event = {
  title: "Builder.io Conf",
  date: new Date(),
};
```

ä½†æ˜¯ï¼Œç•¶ä½ çš„è³‡æ–™ä¸æ˜¯å›ºå®šçš„ key æ™‚ï¼Œæˆ–æ˜¯æœ‰å¤§é‡çš„æ–°å¢ã€åˆªé™¤ã€ä¿®æ”¹çš„æ“ä½œæ™‚ï¼Œä½ æ‡‰è©²ä½¿ç”¨ Mapï¼Œå› ç‚º Map åœ¨é€™ç¨®æƒ…æ³ä¸‹æœ‰è¼ƒå¥½æ•ˆèƒ½ã€‚

```js title="Map is faster when key is not fixed"
// ç•¶ key ä¸æ˜¯å›ºå®šçš„æ™‚å€™ï¼ŒMap æœƒæ¯” Object å¿«
const eventsMap = new Map();
eventsMap.set(event.id, event);
eventsMap.delete(event.id);
```
