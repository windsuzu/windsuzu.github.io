---
id: components-map
title: Components Map
description: åœ¨ React ä¸­ä½¿ç”¨ components map å¯ä»¥æ›´ç²¾ç°¡åœ°ä½¿ç”¨æ¢ä»¶å¼æ¸²æŸ“å…ƒä»¶ã€‚æˆ‘å€‘å¯ä»¥ä½¿ç”¨æ™®é€šçš„ JavaScript ç‰©ä»¶æˆ– Map å‰µå»º components mapï¼Œä»¥åŠä½¿ç”¨ lazy-loading ä½¿å…ƒä»¶å‹•æ…‹è¼‰å…¥ã€‚å¦å¤–ï¼Œåœ¨åˆ‡æ›å…ƒä»¶æ™‚ä½¿ç”¨ startTransition å¯ä»¥é¿å…å…ƒä»¶åˆ‡æ›é–ƒçˆçš„å•é¡Œã€‚æœ€å¾Œï¼Œä½¿ç”¨ components map æœ‰ä¸€å€‹ç¼ºé»ï¼Œå°±æ˜¯ map ä¸­çš„æ‰€æœ‰å…ƒä»¶å¿…é ˆä½¿ç”¨ç›¸åŒçš„ propsã€‚
sidebar_label: ğŸŸ© Components Map
hide_title: true
hide_table_of_contents: false
tags: [react, components, map, lazy, code-splitting]
draft: false
last_updated: 2022-10-09
---

<profile
  title="(Lazy) Components Maps"
  url="https://julesblom.com/writing/lazy-component-maps?ck_subscriber_id=1879469445&utm_source=convertkit&utm_medium=email&utm_campaign=%E2%9A%9B%EF%B8%8F+This+Week+In+React+%23118%3A+Gatsby%2C+Beta+Docs%2C+Reactivity%2C+Lazy+Maps%2C+Ezno%2C+Whyframe%2C+Reassure%2C+Node.js%2C+TypeScript%2C+WASM...%20-%209117597"
  author="Jules Blom"
  level="beginner"
  category={["react/next", "js/ts"]}
/>

éš¨è‘—æƒ…æ³ä¸æ–·çš„å¢åŠ ï¼Œæˆ‘å€‘è¦åšåˆ°æ¢ä»¶å¼çš„æ¸²æŸ“ä¹Ÿæœƒè®Šå¾—è¶Šä¾†è¶Šå›°é›£ã€‚åœ¨ React ä¸­ï¼Œæˆ‘å€‘é€šå¸¸æœƒä½¿ç”¨ if-else æˆ–æ˜¯ switch ä¾†æ¢ä»¶å¼çš„æ¸²æŸ“å…ƒä»¶ã€‚ä½†å…¶å¯¦æˆ‘å€‘å¯ä»¥ä½¿ç”¨ä¸€å€‹ component map ä¾†åšåˆ°é€™ä»¶äº‹æƒ…ï¼

## Component Map

ä¸€å€‹ component map åªæ˜¯ä¸€å€‹å–®ç´”çš„ Javascript ç‰©ä»¶ï¼Œå°‡éµå€¼ (key) å°æ‡‰åˆ° React å…ƒä»¶ã€‚ä»¥ä¸‹æ˜¯ä¸€å€‹ç°¡å–®çš„ç¯„ä¾‹ï¼š

```tsx
const components = {
  day: DayPicker,
  week: WeekPicker,
  month: MonthPicker,
  year: YearPicker,
};

const SelectedPicker = components[type];

return (
  <SelectedPicker
    selectedPeriod={selectedPeriod}
    setSelectedPeriod={setSelectedPeriod}
  />
);
```

:::info
ç‚ºäº†è®“ component map æ˜ å°„å‡ºä¾†çš„å…ƒä»¶èƒ½åœ¨ JSX ä¸­ç›´æ¥ä½¿ç”¨ï¼Œé€™äº›å…ƒä»¶çš„è®Šæ•¸åç¨±é–‹é ­å¿…é ˆå¤§å¯«ï¼
:::

æˆ‘å€‘ä¹Ÿå¯ä»¥ä½¿ç”¨ Map ä¾†ç”¢ç”Ÿ component mapï¼Œä»¥ä¸‹æ˜¯ä¸€å€‹ä½¿ç”¨ Map çš„ç¯„ä¾‹ï¼š

```tsx
const components = new Map([
  ["day", DayPicker],
  ["week", WeekPicker],
  ["month", MonthPicker],
  ["year", YearPicker],
]);
```

## Lazy Component Map

åœ¨ä¸Šé¢çš„ç¯„ä¾‹ä¸­ï¼Œæˆ‘å€‘ä½¿ç”¨äº†ä¸€å€‹ component map ä¾†å°‡éµå€¼å°æ‡‰åˆ° React å…ƒä»¶ï¼Œä½†æ˜¯é€™å€‹ component map æœƒåœ¨é é¢è¼‰å…¥æ™‚å°±å°‡æ‰€æœ‰çš„å…ƒä»¶éƒ½è¼‰å…¥ï¼Œé€™æ¨£å¯èƒ½æœƒå°è‡´é é¢è¼‰å…¥çš„æ™‚é–“è®Šé•·ï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥ä½¿ç”¨ lazy loading (code-splitting) çš„æ–¹å¼ä¾†å°‡å…ƒä»¶å‹•æ…‹è¼‰å…¥ï¼Œä»¥ä¸‹æ˜¯ä¸€å€‹ lazy component map çš„ç¯„ä¾‹ï¼š

```tsx
const components = {
  day: lazy(() => import("./day-picker")),
  week: lazy(() => import("./week-picker")),
  month: lazy(() => import("./month-picker")),
  year: lazy(() => import("./year-picker")),
};

const SelectedPicker = components[type];

return (
  <ErrorBoundary FallbackComponent={ErrorFallback} onError={handleError}>
    <Suspense fallback={<Spinner />}>
      <SelectedPicker />
    </Suspense>
  <ErrorBoundary>
);
```

ç•¶æˆ‘å€‘è¦åˆ‡æ›å…ƒä»¶æ™‚ï¼ŒReact æœƒå…ˆå°‡åŸæœ¬çš„å…ƒä»¶ç§»é™¤ï¼Œç„¶å¾Œå†å°‡æ–°çš„å…ƒä»¶åŠ å…¥ï¼Œé€™æ¨£æœƒå°è‡´é é¢çš„é–ƒçˆï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥ä½¿ç”¨ React çš„ [startTransition](https://beta.reactjs.org/reference/react/startTransition) ä¾†è§£æ±ºé€™å€‹å•é¡Œï¼Œå°‡æ”¹è®Š `useState` çš„é‚è¼¯åŒ…åœ¨ `startTransition` ä¸­å°±å¯ä»¥è§£æ±ºé–ƒçˆçš„å•é¡Œï¼š

```tsx
onChange={(e) => startTransition(() => setType(e.target.value))}
```

## Disadvantages

ä½¿ç”¨ component map ä¾†åšæ¢ä»¶å¼çš„æ¸²æŸ“ï¼Œå¯ä»¥è®“æˆ‘å€‘çš„ç¨‹å¼ç¢¼è®Šå¾—æ›´ç°¡æ½”ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€å€‹ç¼ºé»ã€‚åœ¨ map è£¡é¢çš„å…ƒä»¶ï¼Œå¿…é ˆè¦ä½¿ç”¨åŒæ¨£çš„ propsï¼Œå¦å‰‡å°±æœƒå‡ºç¾éŒ¯èª¤ã€‚é€™æ™‚å€™å°±å¿…é ˆè¦ä½¿ç”¨ switch æˆ–æ˜¯ if-else ä¾†åšæ¢ä»¶å¼çš„æ¸²æŸ“ã€‚

```tsx
switch (type) {
  case "day": {
    return <DayPicker currentDay={today} />;
  }
  case "week": {
    return <WeekPicker currentWeek={week} />;
  }
}
```
