---
id: setcount-three-times
title: setCount Three Times
description: ç•¶ä½ åœ¨åŒä¸€å€‹å‡½å¼ä¸­å‘¼å« setCount ä¸‰æ¬¡æ™‚ï¼Œä½ è¦ºå¾— count æœƒè®Šæˆå¤šå°‘å‘¢ï¼Ÿé€™æœƒæ ¹æ“šä½ ä½¿ç”¨ setCount çš„æ–¹å¼è€Œæœ‰æ‰€ä¸åŒï¼é€™ç¯‡æ–‡ç« æœƒè§£é‡‹ React æ˜¯å¦‚ä½•è™•ç† states çš„æ›´æ–°ã€æ¸²æŸ“çš„é †åºï¼Œæœ€å¾Œäº†è§£é€™å€‹å•é¡Œçš„ç­”æ¡ˆã€‚
sidebar_label: ğŸŸ© setCount Three Times
hide_title: true
hide_table_of_contents: false
tags: [react, use-state, render, batch-update]
draft: true
last_updated: 2023-03-20
---

<profile
  title="Elegantly managing state and renders in React"
  url="https://remotion.com/blog/untangling-state-in-react"
  author="CHANTELLE CHAN, ANGELA WANG"
  level="beginner"
  category={["react/next"]}
/>

ç•¶ä½ åœ¨åŒä¸€å€‹å‡½å¼ä¸­å‘¼å« `setCount` ä¸‰æ¬¡æ™‚ï¼Œä½ è¦ºå¾— count æœƒè®Šæˆå¤šå°‘å‘¢ï¼Ÿé€™æœƒæ ¹æ“šä½ ä½¿ç”¨ `setCount` çš„æ–¹å¼è€Œæœ‰æ‰€ä¸åŒï¼é€™ç¯‡æ–‡ç« æœƒè§£é‡‹ React æ˜¯å¦‚ä½•è™•ç† states çš„æ›´æ–°ã€æ¸²æŸ“çš„é †åºï¼Œæœ€å¾Œäº†è§£é€™å€‹å•é¡Œçš„ç­”æ¡ˆã€‚

```js
const [count, setCount] = useState(0);

const handleClick = () => {
  setCount(count + 1);
  setCount(count + 1);
  setCount(count + 1);
};
```

## React without `useState`

æ¯å€‹ React æ•™å­¸éƒ½æœƒæ•™ä½ å¦‚ä½•ä½¿ç”¨ `useState`ï¼Œä½†å»æ²’å‘Šè¨´ä½ æ²’æœ‰ `useState` æœƒç™¼ç”Ÿä»€éº¼äº‹ã€‚åœ¨ä¸‹é¢çš„ç¯„ä¾‹ä¸­ï¼Œ`count` ä¸¦ä¸æœƒå› ç‚ºæˆ‘å€‘æŒ‰ä¸‹æŒ‰éˆ•è€Œæ›´æ–°ã€‚åŸå› æœ‰å…©å€‹ï¼š

1. æœ¬åœ°è®Šæ•¸ (i.e. `count`) åªæœƒå­˜åœ¨æ–¼æ¯ä¸€å€‹å…¨æ–°çš„ render ä¸­ã€‚ä¹Ÿå°±æ˜¯èªªï¼Œæ¯æ¬¡ render æ™‚ï¼Œ`count` éƒ½æœƒè¢«é‡æ–°åˆå§‹åŒ–ç‚º 0ã€‚
2. æ›´æ–°æœ¬åœ°è®Šæ•¸ (i.e. `count`) ä¸æœƒè§¸ç™¼æ–°çš„ renderã€‚

```jsx live noInline
const Counter = () => {
  let count = 0;

  const handleClick = () => {
    count = count + 1;
  };

  return <button onClick={handleClick}>{count}</button>;
};

render(<Counter />);
```

## React with `useState`

æ‰€ä»¥ `useState` æä¾›äº†å…©å€‹ç‰¹æ€§ï¼Œå¹«åŠ©æˆ‘å€‘è§£æ±ºäº†ä¸Šé¢çš„å•é¡Œã€‚

1. å¹«æˆ‘å€‘åœ¨æ¯ä¸€å€‹ render ä¹‹é–“ä¿ç•™ä½è³‡æ–™ã€‚
2. å¹«æˆ‘å€‘åœ¨è³‡æ–™æ›´æ–°æ™‚ï¼Œå‘Šè¨´ React è§¸ç™¼æ–°çš„ renderã€‚

ä¹Ÿå°±æ˜¯èªªï¼Œ<highlight>React ä¸­çš„ `state` æ˜¯å­˜åœ¨æ–¼ function component ä¹‹å¤–çš„ã€‚ç•¶ React
å‘¼å« component æ™‚ï¼ŒReact æ‰æœƒçµ¦äºˆ component å’Œæ‰€æœ‰çš„ event handler ä¸€å€‹ç‰¹å®š render
çš„ `state` å¿«ç…§ã€‚</highlight>

```jsx live noInline
const Counter = () => {
  const [count, setCount] = useState(0);

  const handleClick = () => {
    setCount(count + 1);

    console.log("count", count);
    setTimeout(() => {
      console.log("count", count);
    }, 1000);
  };

  return <button onClick={handleClick}>{count}</button>;
};

render(<Counter />);
```

åœ¨ä¸Šé¢ç¯„ä¾‹çš„ `handleClick`ï¼Œå„˜ç®¡æˆ‘å€‘åœ¨ `setCount` ä¹‹å¾Œå°å‡º `count`ï¼Œä½† `count` ä»ç„¶æ˜¯ 0ï¼Œç”šè‡³ä½¿ç”¨ `setTimeout` ç­‰å¾…ä¸€ç§’å¾Œä¹Ÿæ˜¯ 0ã€‚é€™æ˜¯å› ç‚ºåœ¨åˆå§‹ render `<Counter>` æ™‚ï¼ŒReact å°±å°‡ `count` ç‚º 0 çš„ `state` è³¦äºˆçµ¦ `<Counter>` ä»¥åŠ `handleClick` (event handler)ã€‚

ç¸½è€Œè¨€ä¹‹ï¼Œä¸€å€‹ `state` çš„å¿«ç…§ä¸æœƒåœ¨åŒä¸€å€‹ `render` ä¸­è¢«æ›´æ–°ï¼Œæ›´æ–°éçš„ `state` å¿«ç…§æœƒåœ¨ä¸‹ä¸€å€‹ `render` ä¸­è¢«ä½¿ç”¨ï¼Œè€Œ `setCount` é™¤äº†æ›´æ–° `state` ä¹‹å¤–ï¼Œä¹Ÿæœƒè§¸ç™¼æ–°çš„ `render`ã€‚

:::tip React Official Docs
A state variableâ€™s value never changes within a render, even if its event handlerâ€™s code is asynchronous.
:::

## Batch state change updates

å›åˆ°é€™ç¯‡æ–‡ç« çš„é–‹é ­ï¼Œç•¶ä½ åœ¨åŒä¸€å€‹å‡½å¼ä¸­å‘¼å« `setCount` ä¸‰æ¬¡æ™‚ï¼Œå¦‚æœé€™ä¸‰æ¬¡å‘¼å«éƒ½æ˜¯ä½¿ç”¨åŒä¸€å€‹ `count` çš„å¿«ç…§ï¼Œé‚£éº¼ `count` å°‡æœƒæ˜¯ 1ï¼å› ç‚º React æœƒå°‡æ‰€æœ‰ setter çš„æ›´æ–°åˆä½µæˆä¸€å€‹æ‰¹æ¬¡ï¼Œä¸¦ä¸”åœ¨ä¸‹ä¸€å€‹ `render` ä¸­ä½¿ç”¨æ›´æ–°å¾Œçš„ `state` å¿«ç…§ã€‚æ‰€ä»¥ä¸‰å€‹ `setCount` å…¶å¯¦éƒ½æ˜¯ `setCount(0 + 1)`ï¼Œè€Œç­‰åˆ°æœ€å¾Œä¸€å€‹ `setCount` çµæŸå¾Œï¼Œä¸‹ä¸€å€‹ `render` ä¸­çš„ `count` å¿«ç…§å°±åªæœƒæ˜¯ 1ã€‚

```jsx live noInline
const Counter = () => {
  console.log("render");
  const [count, setCount] = useState(0);

  const handleClick = () => {
    setCount(count + 1);
    setCount(count + 1);
    setCount(count + 1);
  };

  return <button onClick={handleClick}>{count}</button>;
};

render(<Counter />);
```

ç‚ºäº†è®“é€£çºŒä¸‰æ¬¡ `setCount` çš„çµæœè®Šæˆ 3ï¼Œæˆ‘å€‘å¯ä»¥ç‚ºæ¯ä¸€å€‹ `setCount` å‚³å…¥ä¸€å€‹ **updater function**ï¼Œä¹Ÿå°±æ˜¯ `setCount((prevCount) => prevCount + 1)`ã€‚React åœ¨é€²å…¥ä¸‹ä¸€å€‹ `render` å‰ï¼Œæœƒå°‡æ¯ä¸€æ¬¡å‘¼å« `setCount` æ™‚çš„æœ€æ–°å¿«ç…§é€éåƒæ•¸ (i.e. `prevCount`) å‚³å…¥ updater functionï¼Œä¸¦ä¸”å°‡ updater function çš„å›å‚³å€¼ç•¶ä½œæ–°çš„ `state` å¿«ç…§ã€‚

ä»¥ä¸‹é¢çš„ç¯„ä¾‹ä¾†èªªï¼Œç¬¬ä¸€æ¬¡ `setCount` çš„ `prevCount` æ˜¯ 0ï¼Œæ‰€ä»¥ `prevCount + 1` ç‚º 1ï¼Œç¬¬äºŒæ¬¡ `setCount` çš„ `prevCount` æ˜¯ 1ï¼Œæ‰€ä»¥ `prevCount + 1` ç‚º 2ï¼Œç¬¬ä¸‰æ¬¡ `setCount` çš„ `prevCount` æ˜¯ 2ï¼Œæ‰€ä»¥ `prevCount + 1` ç‚º 3ã€‚

```jsx live noInline
const Counter = () => {
  console.log("render");
  const [count, setCount] = useState(0);

  const handleClick = () => {
    setCount((prevCount) => prevCount + 1);
    setCount((prevCount) => prevCount + 1);
    setCount((prevCount) => prevCount + 1);
  };

  return <button onClick={handleClick}>{count}</button>;
};

render(<Counter />);
```

æœ€å¾Œï¼Œå¦‚æœæˆ‘å€‘æŠŠç¬¬ä¸‰å€‹ `setCount` çš„ updater function æ‹¿æ‰ï¼Œæ”¹æˆ `setCount(0)`ï¼Œé‚£éº¼ä¸‹ä¸€å€‹ `render` çš„ `count` å¿«ç…§å°‡æœƒæ˜¯ 0ã€‚å› ç‚º `setCount(0)` å…¶å¯¦ç­‰æ–¼ `setCount((prevCount) => 0)`ï¼Œæ‰€ä»¥ `setCount(0)` å°±æ˜¯ä¸ç®¡ `prevCount` æ˜¯å¤šå°‘ï¼Œéƒ½å°‡ `count` è¨­ç‚º 0ã€‚

```jsx live noInline
const Counter = () => {
  console.log("render");
  const [count, setCount] = useState(0);

  const handleClick = () => {
    setCount((prevCount) => prevCount + 1);
    setCount((prevCount) => prevCount + 1);
    setCount(0);
  };

  return <button onClick={handleClick}>{count}</button>;
};

render(<Counter />);
```

:::tip Try it
è©¦è‘—å¾ä¸Šé¢çš„ç¯„ä¾‹ä¸­ï¼Œåœ¨ `setCount(0)` ä¹‹å¾Œï¼Œå†åŠ ä¸Šä¸€å€‹ `setCount((prevCount) => prevCount + 1)`ï¼Œçœ‹çœ‹ `count` çš„å€¼æœƒæ˜¯å¤šå°‘ã€‚
:::
