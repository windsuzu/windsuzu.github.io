---
id: is-usestate-asynchronous
title: Is useState Asynchronous
description: é€™ç¯‡æ–‡ç« æ·±å…¥æ¢è¨äº† useState çš„åŒæ­¥ç‰¹æ€§ä»¥åŠéŒ¯èª¤ä½¿ç”¨æ–¹å¼ã€‚ç‰¹åˆ¥æ˜¯åœ¨ä½¿ç”¨ setter å’Œ getter åŒæ™‚çš„æƒ…æ³ä¸‹ï¼Œå®¹æ˜“å‡ºç¾çš„éŒ¯èª¤ï¼Œæˆ‘å€‘å°‡é€éå…·é«”çš„ç¯„ä¾‹ï¼Œå¹«åŠ©ç†è§£éŒ¯èª¤çš„åŸå› å’Œè§£æ±ºæ–¹æ¡ˆã€‚
sidebar_label: ğŸŸ© Is useState Asynchronous?
hide_title: true
hide_table_of_contents: false
tags: [useState, react, asynchronous]
draft: false
last_update:
  date: 2022-10-09
---

<profile
  title="UseState: Asynchronous or what?"
  url="https://www.youtube.com/watch?v=RAJD4KpX8LA"
  author="Jack Herrington"
  level="beginner"
  category={["react/next"]}
/>

è¨±å¤šåˆå¿ƒè€…æœƒèª¤æœƒ `useState` æ˜¯éåŒæ­¥çš„ï¼Œé€™æ˜¯å› ç‚ºä»–å€‘å¸¸å¸¸ä»¥éŒ¯èª¤çš„æ–¹å¼ä½¿ç”¨ `useState`ã€‚ç•¶æˆ‘å€‘åŒæ™‚ä½¿ç”¨ `useState` çš„ setter å’Œ getter æ™‚ï¼Œgetter ä¸¦ä¸æœƒé¦¬ä¸Šä½¿ç”¨ setter è¨­å®šçš„å€¼ï¼Œè€Œæ˜¯æœƒä½¿ç”¨ä¸Šä¸€æ¬¡çš„å€¼ã€‚åªæœ‰åœ¨ä¸‹ä¸€æ¬¡ render æ™‚ï¼Œgetter æ‰æœƒä½¿ç”¨ setter è¨­å®šå¥½çš„å€¼ã€‚æ‰€ä»¥ï¼Œæˆ‘å€‘å¿…é ˆè¨˜å¾— `useState` æ˜¯åŒæ­¥çš„ï¼Œè€Œä¸”æ¯æ¬¡åœ¨ä½¿ç”¨ç‹€æ…‹æ™‚ï¼Œéƒ½å¿…é ˆæ³¨æ„è¦ä½¿ç”¨æœ€æ–°çš„å€¼ã€‚

## Mistake of using useState

æˆ‘å€‘ç”¨å¸¸è¦‹çš„æœå°‹ä¾†èªªæ˜ `useState` çš„éŒ¯èª¤ä½¿ç”¨æ–¹å¼ã€‚å‡è¨­æˆ‘å€‘æœ‰ä¸€å€‹è¡¨å–®ï¼Œè£¡é¢æœ‰ä¸€å€‹è¼¸å…¥æ¡†ï¼Œç•¶ä½¿ç”¨è€…è¼¸å…¥æ™‚ï¼Œæˆ‘å€‘æœƒæŠŠè¼¸å…¥çš„å€¼å­˜åˆ° `search` ç‹€æ…‹ä¸­ï¼Œä¸¦ä¸”åŒæ™‚å¾ API æ‹¿åˆ°è³‡æ–™ï¼Œä¸¦æŠŠè³‡æ–™å­˜åˆ° `results` ç‹€æ…‹ä¸­ã€‚

```tsx
const Search = () => {
  const [search, setSearch] = useState("");
  const [results, setResults] = useState([]);

  const onChange = (event) => {
    // highlight-next-line
    setSearch(event.target.value);

    // error-next-line
    fetch(`/search?${search}`) // still the old "search"
      .then((resp) => resp.json())
      .then(setResults);
  };

  return (
    <div>
      <input value={search} onChange={onChange} />
      {results &&
        results.map((result) => <div key={result.id}>{result.title}</div>)}
    </div>
  );
};
```

åœ¨ä¸Šé¢çš„ç¯„ä¾‹ä¸­ï¼Œæˆ‘å€‘åœ¨ `onChange` ä¸­ï¼Œå…ˆè¨­å®š `search` ç‹€æ…‹ï¼Œç„¶å¾Œå†å»æ‹¿è³‡æ–™ã€‚ä½†ç”±æ–¼åŒæ­¥çš„ç‰¹æ€§ï¼Œè£¡é¢çš„ `setSearch` å’Œ `fetch` æ˜¯åŒæ™‚åŸ·è¡Œçš„ï¼Œæ‰€ä»¥ `fetch` ä¸­çš„ `search` æœƒæ˜¯ä¸Šä¸€æ¬¡çš„å€¼ï¼Œè€Œä¸æ˜¯æˆ‘å€‘ä¸Ÿçµ¦ `setSearch` çš„å€¼ã€‚

ç•¶æˆ‘å€‘ `setSearch` æ™‚ï¼Œè©²çµ„ä»¶æœƒé‡æ–°æ¸²æŸ“ï¼ˆvalue å’Œ onChange éƒ½æœƒæ›´æ–°ï¼‰ã€‚ç„¶å¾Œï¼Œç”±æ–¼æˆ‘å€‘ä½¿ç”¨ç©ºå­—ä¸²é€²è¡Œçš„ `fetch` å·²ç¶“è¢«éåŒæ­¥è§£æå®Œç•¢ï¼Œå®ƒä¹Ÿæœƒè§¸ç™¼ `setResults` å¾è€Œå†æ¬¡å°è‡´è©²çµ„ä»¶é‡æ–°æ¸²æŸ“ã€‚æœ€çµ‚ï¼Œæˆ‘å€‘ä¸ä½†ä¸æœƒå¾—åˆ°æˆ‘å€‘æƒ³è¦çš„çµæœï¼Œå®³é€ æˆå…ƒä»¶ç”¢ç”Ÿå¤šé¤˜çš„æ¸²æŸ“ã€‚

## Solve the problem

æœ€ç°¡å–®çš„åšæ³•æ˜¯åœ¨ `onChange` æ™‚ï¼Œç›´æ¥åˆ©ç”¨ `event.target.value` å–å¾—æœ€æ–°çš„å€¼ï¼Œä¸¦ä¸”æŠŠå®ƒå‚³çµ¦ `setSearch` ä»¥åŠ `fetch`ã€‚

```tsx
const Search = () => {
  const [search, setSearch] = useState("");
  const [results, setResults] = useState([]);

  const onChange = (event) => {
    const searchValue = event.target.value;
    setSearch(searchValue);

    fetch(`/search?${searchValue}`)
      .then((resp) => resp.json())
      .then(setResults);
  };

  return (
    <div>
      <input value={search} onChange={onChange} />
      {results &&
        results.map((result) => <div key={result.id}>{result.title}</div>)}
    </div>
  );
};
```

ç¸½ä¹‹ï¼Œæˆ‘å€‘è¦è¨˜ä½ `useState` æ˜¯åŒæ­¥çš„ã€‚åœ¨åŒæ™‚è¨­ç½®å’Œä½¿ç”¨ç‹€æ…‹æ™‚ï¼Œä½¿ç”¨æœ€æ–°çš„å€¼è‡³é—œé‡è¦ï¼Œä»¥é¿å…å‡ºç¾éŒ¯èª¤ã€‚
