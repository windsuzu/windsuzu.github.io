---
id: common-beginner-mistakes
title: Common Beginner Mistakes
description: é€™ç¯‡æ–‡ç« åˆ—å‡ºäº† 9 é … React é–‹ç™¼è€…å¸¸çŠ¯çš„éŒ¯èª¤ï¼Œä¸¦ä¸”æä¾›äº†è§£æ±ºæ–¹æ³•ã€‚æˆ‘å¾ç•¶ä¸­æ“·å–äº† 6 é …ï¼Œå…¶ä¸­åŒ…æ‹¬äº† (1) ä½¿ç”¨ 0 ä½œç‚º JSX çš„åˆ¤æ–·æ¢ä»¶ï¼Œ(2) ç›´æ¥ä¿®æ”¹ stateï¼Œ(3) æ²’æœ‰çµ¦ list çš„æ¯ä¸€å€‹ item åŠ ä¸Š keyï¼Œ(4) åœ¨ setState å¾Œï¼Œä½¿ç”¨èˆŠçš„ state å€¼ï¼Œ(5) å°‡ input çš„ value åˆå§‹åŒ–ç‚º undefinedï¼Œ(6) èª¤å°‡ async promise ç•¶ä½œ useEffect çš„ return functionã€‚
sidebar_label: ğŸŸ© Common Beginner Mistakes
hide_title: true
hide_table_of_contents: false
keywords: [react, beginner, mistakes]
tags: [react]
draft: false
last_update:
  date: 2023-04-05
---

<profile
  title="Common Beginner Mistakes with React"
  url="https://www.joshwcomeau.com/react/common-beginner-mistakes"
  author="Josh W Comeau"
  level="beginner"
  category={["react/next"]}
/>

é€™ç¯‡æ–‡ç« åˆ—å‡ºäº† 9 é … React é–‹ç™¼è€…å¸¸çŠ¯çš„éŒ¯èª¤ï¼Œä¸¦ä¸”æä¾›äº†è§£æ±ºæ–¹æ³•ã€‚æˆ‘å¾ç•¶ä¸­æ“·å–äº† 6 é …ï¼Œå…¶ä¸­åŒ…æ‹¬äº† (1) ä½¿ç”¨ 0 ä½œç‚º JSX çš„åˆ¤æ–·æ¢ä»¶ï¼Œ(2) ç›´æ¥ä¿®æ”¹ stateï¼Œ(3) æ²’æœ‰çµ¦ list çš„æ¯ä¸€å€‹ item åŠ ä¸Š keyï¼Œ(4) åœ¨ setState å¾Œï¼Œä½¿ç”¨èˆŠçš„ state å€¼ï¼Œ(5) å°‡ input çš„ value åˆå§‹åŒ–ç‚º undefinedï¼Œ(6) èª¤å°‡ async promise ç•¶ä½œ useEffect çš„ return functionã€‚

## éŒ¯èª¤ä¸€ ä½¿ç”¨ 0 ä½œç‚ºæ¸²æŸ“ JSX çš„åˆ¤æ–·æ¢ä»¶

å› ç‚º 0 èˆ‡å…¶ä»– falsy å€¼ (ä¾‹å¦‚ null, undefined, false, NaN, "") ä¸åŒï¼Œå¯ä»¥åœ¨ JSX ä¸­è¢«ç›´æ¥ä½¿ç”¨ã€‚æ‰€ä»¥å¦‚æœä½¿ç”¨ 0 ä½œç‚ºæ¸²æŸ“å…ƒä»¶çš„åˆ¤æ–·æ¢ä»¶æ™‚ï¼Œå°±éå¸¸å®¹æ˜“ç™¼ç”ŸéŒ¯èª¤ã€‚

```jsx title="âŒ ä½¿ç”¨ 0 ä½œç‚ºæ¸²æŸ“ JSX çš„åˆ¤æ–·æ¢ä»¶"
<div>{items.length && <ShoppingList items={items} />}</div>
```

è§£æ±ºæ–¹æ³•æœ‰å…©ç¨®ï¼šç¬¬ä¸€ç¨®æ˜¯å°‡æ¸²æŸ“æ¢ä»¶å¼·åˆ¶è½‰ç‚º booleanï¼Œç¬¬äºŒç¨®æ˜¯ä½¿ç”¨ä¸‰å…ƒé‹ç®—å­ä¾†æ¸²æŸ“å…ƒä»¶ã€‚

```jsx title="âœ… å°‡åˆ¤æ–·æ¢ä»¶è½‰ç‚º boolean"
<div>{items.length > 0 && <ShoppingList items={items} />}</div>
```

```jsx title="âœ… æ”¹ä½¿ç”¨ä¸‰å…ƒé‹ç®—å­"
<div>{items.length ? <ShoppingList items={items} /> : null}</div>
```

## éŒ¯èª¤äºŒ ç›´æ¥ä¿®æ”¹ state

ç”±æ–¼ç›´æ¥ä¿®æ”¹ (mutate) object æˆ– array çš„å€¼ï¼Œå…¶ reference ä¸¦ä¸æœƒæ”¹è®Šï¼Œæ‰€ä»¥ React ä¸¦ä¸æœƒé‡æ–°æ¸²æŸ“å…ƒä»¶ã€‚

```jsx title="âŒ ç›´æ¥ä¿®æ”¹ state"
const [items, setItems] = useState([]);

function addItem(newItem) {
  items.push(newItem); // only mutates the state
  setItems(items); // `items` is still the same reference
}
```

è§£æ±ºæ–¹æ³•æ˜¯ä½¿ç”¨å…¨æ–°çš„ object æˆ– array ä¾†æ›´æ–° stateï¼Œä¾‹å¦‚ä½¿ç”¨å±•é–‹é‹ç®—å­ä¾†è¤‡è£½ object æˆ– arrayã€‚

```jsx title="âœ… ä½¿ç”¨å±•é–‹é‹ç®—å­ä¾†è¤‡è£½ object æˆ– array"
const [items, setItems] = useState([]);

function addItem(newItem) {
  setItems([...items, newItem]);
}
```

## éŒ¯èª¤ä¸‰ æ²’æœ‰çµ¦ list çš„æ¯ä¸€å€‹ item åŠ ä¸Š key

React ä¾é  key prop ä¾†è¾¨è­˜ map ä¸­çš„æ¯å€‹ itemï¼Œä¸¦ä¸”å„ªåŒ–æ¸²æŸ“çš„éç¨‹ã€‚å¦‚æœæ²’æœ‰æä¾› key prop æˆ–ä¸æ˜¯å”¯ä¸€çš„ï¼ŒReact å¯èƒ½æœƒä¸å¿…è¦åœ°éŠ·æ¯€ä¸¦é‡æ–°å»ºç«‹å…ƒä»¶ï¼Œé€™å¯èƒ½æœƒå°æ•ˆèƒ½é€ æˆè² é¢å½±éŸ¿ï¼Œä¸¦ä¸”ç”¢ç”ŸéŒ¯èª¤ã€‚

```jsx title="âŒ æ²’æœ‰çµ¦ list çš„æ¯ä¸€å€‹ item åŠ ä¸Š key"
<ul>
  {items.map((item) => {
    return <li>{item}</li>;
  })}
</ul>
```

è§£æ±ºæ–¹æ³•å°±æ˜¯çµ¦æ¯å€‹ item åŠ ä¸Šå”¯ä¸€çš„ key propï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ `crypto.randomUUID()` ä¾†ç”¢ç”Ÿå”¯ä¸€çš„ keyã€‚ä½†æ˜¯æˆ‘å€‘æ‡‰è©²åœ¨ list åˆå§‹åŒ–çš„æ™‚å€™å°±ç”¢ç”Ÿå¥½ keyï¼Œè€Œä¸æ˜¯åœ¨ map çš„æ™‚å€™ã€‚

```jsx title="âŒ åœ¨ map çš„æ™‚å€™ç”¢ç”Ÿ key"
<ul>
  {items.map((item) => {
    return <li key={crypto.randomUUID()}>{item}</li>;
  })}
</ul>
```

```jsx title="âœ… çµ¦æ¯å€‹ item åŠ ä¸Šå”¯ä¸€çš„ key prop"
const [items, setItems] = useState([]);

function addItem(newItem) {
  setItems([
    ...items,
    {
      id: crypto.randomUUID(),
      value: newItem,
    },
  ]);
}

<ul>
  {items.map((item) => {
    return <li key={item.id}>{item.value}</li>;
  })}
</ul>;
```

:::tip
å¦å¤–ï¼ŒReact ä¸å»ºè­°ä½¿ç”¨é™£åˆ—çš„ index ä½œç‚º key propï¼Œå› ç‚ºé€™å¯èƒ½æœƒå°è‡´æ•ˆèƒ½å•é¡Œå’Œæ„å¤–çš„éŒ¯èª¤ã€‚åˆ° [React Docs - rendering lists](https://react.dev/learn/rendering-lists#why-does-react-need-keys) æŸ¥çœ‹æ›´å¤šè³‡è¨Šã€‚
:::

## éŒ¯èª¤å›› åœ¨ setState å¾Œï¼Œä»¥ç‚º state å·²ç¶“æ›´æ–°

å› ç‚º state æ˜¯æ¯å€‹æ¸²æŸ“çš„å¿«ç…§ï¼ˆsnapshotï¼‰ï¼Œæ‰€ä»¥ç•¶ä½ åœ¨å‡½å¼ä¸­åŒæ™‚ä½¿ç”¨ setState èˆ‡ state æ™‚ï¼Œä½ å¯¦éš›ä¸Šä½¿ç”¨çš„æ˜¯èˆŠçš„ state å¿«ç…§ã€‚

```jsx title="âŒ åœ¨ setState å¾Œï¼Œä»¥ç‚º state å·²ç¶“æ›´æ–°"
const [count, setCount] = useState(0);

function handleClick() {
  setCount((prev) => prev + 1);
  console.log(count); // count is still 0

  setTimeout(() => {
    console.log(count); // count is still 0
  }, 1000);
}
```

è§£æ±ºæ–¹æ³•æ˜¯å¦å¤–å®šç¾©ä¸€å€‹è®Šæ•¸ä¾†å„²å­˜æ›´æ–°å¾Œçš„ stateï¼Œä½¿ç”¨è©²è®Šæ•¸ä¾†æ›´æ–° state ä¸¦ç”¨æ–¼å…¶ä»–çš„æ“ä½œã€‚

```jsx title="âœ… å¦å¤–å®šç¾©ä¸€å€‹è®Šæ•¸ä¾†å„²å­˜æ›´æ–°å¾Œçš„ state"
const [count, setCount] = useState(0);

function handleClick() {
  const newCount = count + 1;
  setCount(newCount);
  console.log(newCount); // newCount is 1
}
```

## éŒ¯èª¤äº” æ²’æœ‰åˆå§‹åŒ– input çš„ value

å¦‚æœæ²’æœ‰åˆå§‹åŒ– input çš„ valueï¼ŒReact æœƒå°‡å…¶è¦–ç‚º uncontrolled componentï¼Œä¸¦ä¸”ä¸æœƒå°å…¶é€²è¡Œç®¡ç†ã€‚ä½†æ˜¯ç•¶ä½ åœ¨ä¹‹å¾Œå°‡ input çš„ value è¨­å®šç‚ºä¸€å€‹é undefined çš„å€¼æ™‚ï¼ŒReact å°±æœƒå°‡å…¶è¦–ç‚º controlled componentã€‚é€™å€‹æ™‚å€™ React å°±æœƒè·³å‡ºéŒ¯èª¤è¨Šæ¯ï¼š`Warning: A component is changing an uncontrolled input to be controlled.`ã€‚ä¸€å€‹ input å¾ uncontrolled åˆ‡æ›åˆ° controlled æˆ–æ˜¯åéä¾†ï¼Œéƒ½æœƒå°è‡´æ„æƒ³ä¸åˆ°çš„è¡Œç‚ºå’ŒéŒ¯èª¤ã€‚

```jsx title="âŒ æ²’æœ‰åˆå§‹åŒ– input çš„ value"
const [value, setValue] = useState();

<input value={value} onChange={(e) => setValue(e.target.value)} />;
```

è§£æ±ºæ–¹æ³•å¾ˆç°¡å–®ï¼Œåªè¦åœ¨ useState ä¸­åˆå§‹åŒ–ä¸€å€‹ç©ºå­—ä¸²å°±å¯ä»¥äº†ã€‚

```jsx title="âœ… åˆå§‹åŒ– input çš„ value"
const [value, setValue] = useState("");

<input value={value} onChange={(e) => setValue(e.target.value)} />;
```

## éŒ¯èª¤å…­ ç›´æ¥å°‡ useEffect è¨­å®šç‚º async

å¦‚æœç›´æ¥å°‡ useEffect è¨­å®šç‚º asyncï¼Œreturn function å°±æœƒè®Šæˆä¸€å€‹ promiseï¼Œè€Œ React åªæœŸæœ›æˆ‘å€‘å›å‚³ä¸€å€‹æ¸…é™¤å‡½å¼æˆ–æ˜¯ undefinedã€‚

```jsx title="âŒ ç›´æ¥å°‡ useEffect è¨­å®šç‚º async"
useEffect(async () => {
  const url = `${API}/get-profile?id=${userId}`;
  const res = await fetch(url);
  const json = await res.json();
  setUser(json);
}, [userId]);
```

è§£æ±ºæ–¹æ³•æ˜¯åœ¨ useEffect ä¸­å»ºç«‹ä¸€å€‹ async functionï¼Œä¸¦ä¸”ç›´æ¥å‘¼å«å®ƒã€‚

```jsx title="âœ… åœ¨ useEffect ä¸­å»ºç«‹ä¸€å€‹ async function"
useEffect(() => {
  async function fetchUser() {
    const url = `${API}/get-profile?id=${userId}`;
    const res = await fetch(url);
    const json = await res.json();
    setUser(json);
  }

  fetchUser();

  return () => {
    // cleanup if needed
  };
}, [userId]);
```
