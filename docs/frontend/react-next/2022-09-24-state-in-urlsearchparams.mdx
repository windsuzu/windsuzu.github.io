---
id: state-in-urlsearchparams
title: State in URLSearchParams
description: æœ¬ç¯‡æ–‡ç« ä»‹ç´¹äº†åœ¨ React ä¸­å¦‚ä½•ä½¿ç”¨ URLSearchParams å„²å­˜ç‹€æ…‹ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ React Router æä¾›çš„ useSearchParams å’Œ useLocation ä¾†ç®¡ç†å’Œåˆ†äº«ç‹€æ…‹ã€‚é‚„å°è£äº†ä¸€å€‹ useSearchParamsStateï¼Œæä¾›äº†é¡ä¼¼ useState çš„ APIã€‚
sidebar_label: ğŸŸ¨ State in URLSearchParams
hide_title: true
hide_table_of_contents: false
tags: [react, react-router, urlsearchparams]
draft: false
last_update:
  date: 2022-09-24
---

<profile
  title="React: storing state in URL with URLSearchParams"
  url="https://blog.johnnyreilly.com/2022/09/20/react-usesearchparamsstate?utm_source=pocket_mylist"
  author="John Reilly"
  level="intermediate"
  category={["react/next"]}
/>

æœ¬ç¯‡æ–‡ç« ä»‹ç´¹äº†åœ¨ React ä¸­å¦‚ä½•ä½¿ç”¨ URLSearchParams å„²å­˜ç‹€æ…‹ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ React Router æä¾›çš„ useSearchParams å’Œ useLocation ä¾†ç®¡ç†å’Œåˆ†äº«ç‹€æ…‹ã€‚é‚„å°è£äº†ä¸€å€‹ useSearchParamsStateï¼Œæä¾›äº†é¡ä¼¼ useState çš„ APIã€‚

## Stateful URL

åœ¨ React ä¸­ï¼Œç°¡å–®çš„ `useState` é›–ç„¶å¯ä»¥ç®¡ç†ç‹€æ…‹ï¼Œä½†ä¸¦ä¸èƒ½é•·ä¹…ä¿å­˜ï¼Œä¹Ÿä¸èƒ½åˆ†äº«çµ¦å¤šå€‹é é¢ã€‚ä½†æœ‰äº† [`URLSearchParams`](https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams)ï¼Œåªè¦ URL é•·åº¦æ²’æœ‰è¶…éé™åˆ¶ ([ç´„ 2000 å€‹å­—ç¬¦](https://stackoverflow.com/a/417184/761388))ï¼Œæˆ‘å€‘å°±å¯ä»¥å°‡ç‹€æ…‹ä¿å­˜åœ¨ URL ä¸­ï¼Œä¸¦ä¸”å¯ä»¥åˆ†äº«çµ¦å…¶ä»–é é¢ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ï¼Œæˆ‘å€‘å°‡ `greeting` å’Œ `name` å…©å€‹è®Šæ•¸ä¿å­˜åœ¨ URL ä¸­ã€‚

```
https://our-app.com?greeting=hi&name=john
```

## React Router - `useSearchParams`

[React Router](https://reactrouter.com/en/main) æä¾›äº† `useSearchParams`ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°è®“æˆ‘å€‘ä½¿ç”¨ `URLSearchParams` ä¾†ç®¡ç†ä¸¦åˆ†äº«ç‹€æ…‹ã€‚

```js
import { useSearchParams } from "react-router-dom";
const [searchParams, setSearchParams] = useSearchParams();

// will set URL like: https://our-app.com?greeting=bonjour
// this value will feed through to anything driven by the URL
setSearchParams({ greeting: "bonjour" });

// this will be "bonjour"
const greeting = searchParams.get("greeting");
```

## `useSearchParamsState`

æˆ‘å€‘å¯ä»¥é€²ä¸€æ­¥å°‡ `useSearchParams` å°è£æˆ `useSearchParamsState`ï¼Œè®“æˆ‘å€‘åœ¨æ”¹è®Šå–®å€‹åƒæ•¸æ™‚ï¼Œä¸æœƒä¸Ÿå¤±å…¶ä»–åƒæ•¸ã€‚è¿”å›çš„ `setSearchParamsState` å‡½æ•¸ï¼Œå¯ä»¥æ¥å—ä¸€å€‹æ–°çš„å€¼ï¼Œä¸¦ä¸”é€é `Object.assign` ä»¥åŠ `reduce` çš„æŠ€å·§ï¼Œå°‡æ–°çš„å€¼èˆ‡èˆŠçš„å€¼åˆä½µã€‚

```tsx
import { useSearchParams } from "react-router-dom";

export function useSearchParamsState(
  searchParamName: string,
  defaultValue: string
): readonly [
  searchParamsState: string,
  setSearchParamsState: (newState: string) => void
] {
  const [searchParams, setSearchParams] = useSearchParams();

  const acquiredSearchParam = searchParams.get(searchParamName);
  const searchParamsState = acquiredSearchParam ?? defaultValue;

  // highlight-start
  const setSearchParamsState = (newState: string) => {
    const next = Object.assign(
      {},
      [...searchParams.entries()].reduce(
        (o, [key, value]) => ({ ...o, [key]: value }),
        {}
      ),
      { [searchParamName]: newState }
    );
    setSearchParams(next);
  };
  // highlight-end
  return [searchParamsState, setSearchParamsState];
}
```

ç”¨æ³•åƒä¸‹é¢é€™æ¨£ï¼Œæˆ‘å€‘å‚³å…¥ä¸€å€‹ `searchParamName` å’Œ `defaultValue`ï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€å€‹é¡ä¼¼ `useState` çš„ APIã€‚

```tsx
const [greeting, setGreeting] = useSearchParamsState("greeting", "hello");
```

:::note
[æ›´æ·±å…¥äº†è§£ Object.assign](https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)ï¼Œé€™è£¡æä¾›ä¸€å€‹ç°¡å–®çš„ç¯„ä¾‹ï¼š

```js
var o1 = { a: 1, b: 1 };
var o2 = { b: 2 };
var o3 = { c: 3 };

var obj = Object.assign(o1, o2, o3);
console.log(obj); // { a: 1, b: 2, c: 3 }
console.log(o1); // { a: 1, b: 2, c: 3 }, æ”¾åœ¨ç¬¬ä¸€å€‹çš„ç‰©ä»¶æœ¬èº«ä¹Ÿæœƒè¢«æ”¹è®Šã€‚
```

:::

## Persisting query across pages

åªæœ‰ `useSearchParamsState` æ˜¯ä¸è¶³ä»¥åœ¨é é¢ä¹‹é–“å‚³éåƒæ•¸çš„ã€‚ç‚ºäº†åšåˆ°é€™ä¸€é»ï¼Œæˆ‘å€‘éœ€è¦ä½¿ç”¨ `useLocation` ä¾†ç²å–ç•¶å‰çš„åƒæ•¸ï¼Œä¸¦å°‡å®ƒå€‘å‚³éçµ¦å…¶ä»–é€£çµã€‚

```tsx
import { useLocation } from "react-router-dom";

const [location] = useLocation();
return (<Link to={`/my-page${location.search}`}>Page</>)
```
