---
id: function-composition
title: Function Composition
description: æœ¬æ–‡ä»‹ç´¹äº†å¦‚ä½•ä½¿ç”¨ Function Composition ä¾†å°‡ React å°ˆæ¡ˆä¸­çš„ cross-cutting concerns çµ„åˆæˆä¸€å€‹ HOCï¼Œä¸¦ä¸”ä½¿ç”¨ currying ä¾†è§£æ±º HOC éœ€è¦æœ‰æ¢ä»¶çš„æ¸²æŸ“çš„å•é¡Œã€‚ä½œè€…æå‡ºçš„è§£æ±ºæ–¹æ¡ˆæ˜¯å°‡é€™äº›é‡è¤‡çš„å€å¡Š cross-cutting concerns é€é function composition æŠŠå¤šå€‹ HOC çµ„åˆæˆä¸€å€‹å¤§çš„ HOCï¼Œç„¶å¾Œåœ¨å°ˆæ¡ˆä¸­ä½¿ç”¨å®ƒï¼Œä»¥æ¸›å°‘é‡è¤‡çš„å·¥ä½œã€‚
sidebar_label: ğŸŸ© Function Composition
hide_title: true
hide_table_of_contents: false
tags: [react, function-composition, hoc, currying, higher-order-component]
draft: false
last_update:
  date: 2022-09-24
---

<profile
  title="Why Every React Developer Should Learn Function Composition"
  url="https://medium.com/javascript-scene/why-every-react-developer-should-learn-function-composition-23f41d4db3b1"
  author="Eric Elliott"
  level="beginner"
  category={["react/next"]}
/>

æœ¬æ–‡ä»‹ç´¹äº†å¦‚ä½•ä½¿ç”¨ Function Composition ä¾†å°‡ React å°ˆæ¡ˆä¸­çš„ cross-cutting concerns çµ„åˆæˆä¸€å€‹ HOCï¼Œä¸¦ä¸”ä½¿ç”¨ currying ä¾†è§£æ±º HOC éœ€è¦æœ‰æ¢ä»¶çš„æ¸²æŸ“çš„å•é¡Œã€‚ä½œè€…æå‡ºçš„è§£æ±ºæ–¹æ¡ˆæ˜¯å°‡é€™äº›é‡è¤‡çš„å€å¡Š cross-cutting concerns é€é function composition æŠŠå¤šå€‹ HOC çµ„åˆæˆä¸€å€‹å¤§çš„ HOCï¼Œç„¶å¾Œåœ¨å°ˆæ¡ˆä¸­ä½¿ç”¨å®ƒï¼Œä»¥æ¸›å°‘é‡è¤‡çš„å·¥ä½œã€‚

## Background

åœ¨ React å°ˆæ¡ˆä¸­ï¼Œå¸¸å¸¸æœƒæœ‰ä¸€äº›é‡è¤‡çš„å·¥ä½œéœ€è¦åœ¨æ¯å€‹é é¢ä¸Šéƒ½å¯¦ç¾ä¸€æ¬¡ã€‚æ¯”å¦‚èªè­‰ã€logã€æ¢ä»¶æ¸²æŸ“å’ŒåŸºæœ¬çš„ layout (å°èˆªã€å´é‚Šæ¬„ç­‰)ã€‚é€™äº›æ±è¥¿è¢«ç¨±ç‚º <highlight>cross-cutting concerns</highlight>ã€‚

èµ·åˆï¼Œä½ å¯èƒ½æœƒåœ¨æ¯å€‹é é¢ä¸Šéƒ½ä½¿ç”¨é€™äº›é‡è¤‡çš„å€å¡Š (cross-cutting concerns)ï¼š

```jsx title="MyPage.jsx"
const MyPage = ({ user = {}, signIn, features = [], log }) =>
{
  // Check and update user authentication status
  // highlight-start
  useEffect(() => {
    if (!user.isSignedIn) {
      signIn();
    }
  }, [user]);
  // highlight-end

  // Log each page component mount
  // highlight-start
  useEffect(() => {
    log({
      type: 'page',
      name: 'MyPage',
      user: user.id,
    });
  }, []);
  // highlight-end

  return <>
    {
      /* render the standard layout */
      // highlight-start
      user.isSignedIn ?
        <NavHeader>
          <NavBar />
          {
            features.includes('new-nav-feature')
            && <NewNavFeature />
          }
        </NavHeader>
        // highlight-end
          <div className="content">
            {/* our actual page content... */}
          </div>
        <Footer /> :
        // highlight-next-line
        <SignInComponent />
    }
  </>;
};
```

è°æ˜çš„ä½ å¯èƒ½æœƒæƒ³è¦æŠŠé€™äº›é‡è¤‡çš„å€å¡ŠæŠ½å‡ºä¾†ï¼Œè®Šæˆå¤šå€‹ Providersã€‚ä½†æ˜¯ï¼Œé€™æ¨£åè€Œæœƒè®“ä½ çš„ç¨‹å¼ç¢¼è®Šå¾—æ›´è¤‡é›œï¼Œå› ç‚ºä½ éœ€è¦åœ¨æ¯å€‹é é¢ä¸Šéƒ½é‡è¤‡å¼•å…¥é€™äº› Providersã€‚è€Œä¸”ï¼Œå¦‚æœä½ æƒ³è¦æ–°å¢ä¸€å€‹æ–°çš„ Providerï¼Œä½ é‚„éœ€è¦åœ¨æ¯å€‹é é¢ä¸Šéƒ½å¼•å…¥å®ƒã€‚

```jsx title="MyPage.jsx"
const MyPage = ({ user = {}, signIn, features = [], log }) => {
  return (
    <>
      <AuthStatusProvider>
        <FeatureProvider>
          <LogProvider>
            <StandardLayout>
              <div className="content">{/* our actual page content... */}</div>
            </StandardLayout>
          </LogProvider>
        </FeatureProvider>
      </AuthStatusProvider>
    </>
  );
};
```

## Function Composition

ä½œè€…æè­°çš„è§£æ±ºæ–¹æ¡ˆæ˜¯å°‡é€™äº›é‡è¤‡çš„å€å¡Š cross-cutting concerns <highlight>é€é function composition</highlight> çµ„åˆæˆä¸€å€‹åˆå¤§åˆå¯ä»¥è¼•é¬†ç¶­è­·çš„å…ƒä»¶ï¼Œé€™å€‹å…ƒä»¶å«åš <highlight>HOC (Higher-Order Component)</highlight>ã€‚å¦‚æœä»»ä½•ä¸€å€‹å€å¡Šéœ€è¦é€éåƒæ•¸æœ‰æ¢ä»¶çš„æ¸²æŸ“ï¼Œé‚£éº¼å°±<highlight>ä½¿ç”¨ currying</highlight> ä¾†è™•ç†è©²å€å¡Šã€‚

### HOC

HOC æ˜¯ä¸€å€‹å‡½æ•¸ï¼Œå®ƒæ¥æ”¶ä¸€å€‹å…ƒä»¶ä¸¦è¿”å›ä¸€å€‹æ–°çš„å…ƒä»¶ã€‚æ–°çš„å…ƒä»¶å°‡æœƒæ¸²æŸ“åŸæœ¬çš„å…ƒä»¶ï¼Œä½†æ˜¯æ·»åŠ äº†ä¸€äº›é¡å¤–çš„åŠŸèƒ½ã€‚

```jsx title="MyPage.jsx"
// WithLogger is a HOC
const withLogger = (WrappedComponent) => {
  return function LoggingProvider({ user, ...props }) {
    useEffect(() => {
      log({
        type: "page",
        name: "MyPage",
        user: user.id,
      });
    }, []);
    return <WrappedComponent {...props} />;
  };
};

const MyPage = ({ user = {}, signIn, features = [], log }) => {
  return <>{/* our actual page content... */}</>;
};

// highlight-next-line
const MyPageWithLogger = withLogger(MyPage);
```

### Function Composition

æˆ‘å€‘çš„ç›®æ¨™æ˜¯å°‡å¤šå€‹ HOC çµ„åˆæˆä¸€å€‹å¤§çš„ HOCï¼Œç„¶å¾Œåœ¨æˆ‘å€‘çš„é é¢ä¸Šä½¿ç”¨å®ƒã€‚æˆ‘å€‘å¯ä»¥ä½¿ç”¨ function composition çš„æ¦‚å¿µï¼Œå°‡å¤šå€‹å‡½æ•¸çµåˆèµ·ä¾†ï¼Œç”¢ç”Ÿä¸€å€‹æ–°çš„å‡½æ•¸ã€‚åœ¨ä»£æ•¸ä¸­ï¼Œå®ƒè¢«è¡¨ç¤ºç‚º `(f âˆ˜ g)(x) = f(g(x))`ã€‚åœ¨ JavaScript ä¸­ï¼Œæˆ‘å€‘å¯ä»¥å®šç¾©ä¸€å€‹ `compose` å‡½æ•¸ä¾†å¯¦ç¾é€™å€‹æ¦‚å¿µã€‚

```jsx title="MyPage.jsx"
const compose =
  (...fns) =>
  (x) =>
    fns.reduceRight((y, f) => f(y), x);

const withProviders = compose(withUser, withFeatures, withLogger, withLayout);

export default withProviders;
```

### Currying

æ¯å€‹é é¢å¯èƒ½æœƒå° HOC æœ‰ä¸åŒçš„éœ€æ±‚ï¼Œæ‰€ä»¥æˆ‘å€‘éœ€è¦ä¸€å€‹æ–¹æ³•ä¾†è®“ HOC æœ‰æ¢ä»¶çš„æ¸²æŸ“ã€‚ä¾‹å¦‚ï¼ŒæŸä¸€å€‹é é¢ä¸æƒ³é¡¯ç¤º footerï¼Œé‚£éº¼æˆ‘å€‘å°±å¯ä»¥é€é currying ä¾†è™•ç†é€™å€‹å•é¡Œã€‚Currying å°±æ˜¯ä¸€å€‹å‡½æ•¸ï¼Œå®ƒæ¥æ”¶ä¸€å€‹åƒæ•¸ä¸¦è¿”å›åŸæœ¬çš„å‡½æ•¸ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘å€‘å°‡ `withLayout` å‡½æ•¸ curryingï¼Œç„¶å¾Œå°‡ `showFooter` ä½œç‚ºåƒæ•¸å‚³å…¥ç²å¾—åŸæœ¬çš„ `withLayout` å‡½æ•¸ã€‚é€™æ™‚å€™çš„ `withLayout` å‡½æ•¸å°±å¯ä»¥æ ¹æ“š `showFooter` çš„å€¼ä¾†æ±ºå®šæ˜¯å¦æ¸²æŸ“ footerã€‚

```jsx title="MyPage.jsx" {2,16-17}
const withLayout =
  ({ showFooter = true }) =>
  (WrappedComponent) => {
    return function LayoutProvider({ features, ...props }) {
      return (
        <>
          ...
          <WrappedComponent features={features} {...props} />
          {showFooter && <Footer />}
        </>
      );
    };
  };

// We need to curry the withProviders function as well:
const withProviders = ({ showFooter }) =>
  compose(withUser, withFeatures, withLogger, withLayout({ showFooter }));
```

### HOC Usage

ç¾åœ¨æˆ‘å€‘å·²ç¶“å®šç¾©å¥½äº†ä¸€å€‹ HOCï¼Œæˆ‘å€‘å¯ä»¥åœ¨é é¢ä¸Šä½¿ç”¨å®ƒäº†ã€‚æˆ‘å€‘å¯ä»¥é€é `withProviders` ä¾†æ¸²æŸ“é é¢ï¼Œä¸¦ä¸”å‚³å…¥ä¸€å€‹åƒæ•¸ä¾†æ±ºå®šæ˜¯å¦é¡¯ç¤º footerã€‚

```jsx title="MyPage.jsx"
const MyPage = ({ user = {}, signIn, features = [], log }) => {
  return <>{/* our actual page content... */}</>;
};

const MyPageWithProviders = withProviders({
  showFooter: false,
})(MyPage);
```
