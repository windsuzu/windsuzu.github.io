"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[3979],{3905:(e,a,t)=>{t.d(a,{Zo:()=>u,kt:()=>d});var r=t(7294);function n(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function s(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?s(Object(t),!0).forEach((function(a){n(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function c(e,a){if(null==e)return{};var t,r,n=function(e,a){if(null==e)return{};var t,r,n={},s=Object.keys(e);for(r=0;r<s.length;r++)t=s[r],a.indexOf(t)>=0||(n[t]=e[t]);return n}(e,a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)t=s[r],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}var i=r.createContext({}),l=function(e){var a=r.useContext(i),t=a;return e&&(t="function"==typeof e?e(a):o(o({},a),e)),t},u=function(e){var a=l(e.components);return r.createElement(i.Provider,{value:a},e.children)},m="mdxType",p={inlineCode:"code",wrapper:function(e){var a=e.children;return r.createElement(r.Fragment,{},a)}},h=r.forwardRef((function(e,a){var t=e.components,n=e.mdxType,s=e.originalType,i=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),m=l(t),h=n,d=m["".concat(i,".").concat(h)]||m[h]||p[h]||s;return t?r.createElement(d,o(o({ref:a},u),{},{components:t})):r.createElement(d,o({ref:a},u))}));function d(e,a){var t=arguments,n=a&&a.mdxType;if("string"==typeof e||n){var s=t.length,o=new Array(s);o[0]=h;var c={};for(var i in a)hasOwnProperty.call(a,i)&&(c[i]=a[i]);c.originalType=e,c[m]="string"==typeof e?e:n,o[1]=c;for(var l=2;l<s;l++)o[l]=t[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}h.displayName="MDXCreateElement"},4203:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>i,contentTitle:()=>o,default:()=>m,frontMatter:()=>s,metadata:()=>c,toc:()=>l});var r=t(7462),n=(t(7294),t(3905));const s={id:"state-in-urlsearchparams",title:"State in URLSearchParams",description:"\u672c\u7bc7\u6587\u7ae0\u4ecb\u7d39\u4e86\u5728 React \u4e2d\u5982\u4f55\u4f7f\u7528 URLSearchParams \u5132\u5b58\u72c0\u614b\uff0c\u4ee5\u53ca\u5982\u4f55\u4f7f\u7528 React Router \u63d0\u4f9b\u7684 useSearchParams \u548c useLocation \u4f86\u7ba1\u7406\u548c\u5206\u4eab\u72c0\u614b\u3002\u9084\u5c01\u88dd\u4e86\u4e00\u500b useSearchParamsState\uff0c\u63d0\u4f9b\u4e86\u985e\u4f3c useState \u7684 API\u3002",sidebar_label:"\ud83d\udfe8 State in URLSearchParams",hide_title:!0,hide_table_of_contents:!1,tags:["react","react-router","urlsearchparams"],draft:!1,last_updated:new Date("2022-09-24T00:00:00.000Z")},o=void 0,c={unversionedId:"frontend/react-next/state-in-urlsearchparams",id:"frontend/react-next/state-in-urlsearchparams",title:"State in URLSearchParams",description:"\u672c\u7bc7\u6587\u7ae0\u4ecb\u7d39\u4e86\u5728 React \u4e2d\u5982\u4f55\u4f7f\u7528 URLSearchParams \u5132\u5b58\u72c0\u614b\uff0c\u4ee5\u53ca\u5982\u4f55\u4f7f\u7528 React Router \u63d0\u4f9b\u7684 useSearchParams \u548c useLocation \u4f86\u7ba1\u7406\u548c\u5206\u4eab\u72c0\u614b\u3002\u9084\u5c01\u88dd\u4e86\u4e00\u500b useSearchParamsState\uff0c\u63d0\u4f9b\u4e86\u985e\u4f3c useState \u7684 API\u3002",source:"@site/docs/frontend/react-next/2022-09-24-state-in-urlsearchparams.mdx",sourceDirName:"frontend/react-next",slug:"/frontend/react-next/state-in-urlsearchparams",permalink:"/frontend/react-next/state-in-urlsearchparams",draft:!1,editUrl:"https://github.com/windsuzu/windsuzu.github.io/tree/master/docs/frontend/react-next/2022-09-24-state-in-urlsearchparams.mdx",tags:[{label:"react",permalink:"/tags/react"},{label:"react-router",permalink:"/tags/react-router"},{label:"urlsearchparams",permalink:"/tags/urlsearchparams"}],version:"current",lastUpdatedAt:1678630745,formattedLastUpdatedAt:"2023\u5e743\u670812\u65e5",frontMatter:{id:"state-in-urlsearchparams",title:"State in URLSearchParams",description:"\u672c\u7bc7\u6587\u7ae0\u4ecb\u7d39\u4e86\u5728 React \u4e2d\u5982\u4f55\u4f7f\u7528 URLSearchParams \u5132\u5b58\u72c0\u614b\uff0c\u4ee5\u53ca\u5982\u4f55\u4f7f\u7528 React Router \u63d0\u4f9b\u7684 useSearchParams \u548c useLocation \u4f86\u7ba1\u7406\u548c\u5206\u4eab\u72c0\u614b\u3002\u9084\u5c01\u88dd\u4e86\u4e00\u500b useSearchParamsState\uff0c\u63d0\u4f9b\u4e86\u985e\u4f3c useState \u7684 API\u3002",sidebar_label:"\ud83d\udfe8 State in URLSearchParams",hide_title:!0,hide_table_of_contents:!1,tags:["react","react-router","urlsearchparams"],draft:!1,last_updated:"2022-09-24T00:00:00.000Z"},sidebar:"react-next",previous:{title:"\ud83d\udfe9 useImperativeHandle",permalink:"/frontend/react-next/use-imperative-handle"},next:{title:"\ud83d\udfe9 React Scroll Animations",permalink:"/frontend/react-next/react-scroll-animations"}},i={},l=[{value:"Stateful URL",id:"stateful-url",level:2},{value:"React Router - <code>useSearchParams</code>",id:"react-router---usesearchparams",level:2},{value:"<code>useSearchParamsState</code>",id:"usesearchparamsstate",level:2},{value:"Persisting query across pages",id:"persisting-query-across-pages",level:2}],u={toc:l};function m(e){let{components:a,...t}=e;return(0,n.kt)("wrapper",(0,r.Z)({},u,t,{components:a,mdxType:"MDXLayout"}),(0,n.kt)("profile",{title:"React: storing state in URL with URLSearchParams",url:"https://blog.johnnyreilly.com/2022/09/20/react-usesearchparamsstate?utm_source=pocket_mylist",author:"John Reilly",level:"intermediate",category:["react/next"]}),(0,n.kt)("p",null,"\u672c\u7bc7\u6587\u7ae0\u4ecb\u7d39\u4e86\u5728 React \u4e2d\u5982\u4f55\u4f7f\u7528 URLSearchParams \u5132\u5b58\u72c0\u614b\uff0c\u4ee5\u53ca\u5982\u4f55\u4f7f\u7528 React Router \u63d0\u4f9b\u7684 useSearchParams \u548c useLocation \u4f86\u7ba1\u7406\u548c\u5206\u4eab\u72c0\u614b\u3002\u9084\u5c01\u88dd\u4e86\u4e00\u500b useSearchParamsState\uff0c\u63d0\u4f9b\u4e86\u985e\u4f3c useState \u7684 API\u3002"),(0,n.kt)("h2",{id:"stateful-url"},"Stateful URL"),(0,n.kt)("p",null,"\u5728 React \u4e2d\uff0c\u7c21\u55ae\u7684 ",(0,n.kt)("inlineCode",{parentName:"p"},"useState")," \u96d6\u7136\u53ef\u4ee5\u7ba1\u7406\u72c0\u614b\uff0c\u4f46\u4e26\u4e0d\u80fd\u9577\u4e45\u4fdd\u5b58\uff0c\u4e5f\u4e0d\u80fd\u5206\u4eab\u7d66\u591a\u500b\u9801\u9762\u3002\u4f46\u6709\u4e86 ",(0,n.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams"},(0,n.kt)("inlineCode",{parentName:"a"},"URLSearchParams")),"\uff0c\u53ea\u8981 URL \u9577\u5ea6\u6c92\u6709\u8d85\u904e\u9650\u5236 (",(0,n.kt)("a",{parentName:"p",href:"https://stackoverflow.com/a/417184/761388"},"\u7d04 2000 \u500b\u5b57\u7b26"),")\uff0c\u6211\u5011\u5c31\u53ef\u4ee5\u5c07\u72c0\u614b\u4fdd\u5b58\u5728 URL \u4e2d\uff0c\u4e26\u4e14\u53ef\u4ee5\u5206\u4eab\u7d66\u5176\u4ed6\u9801\u9762\u3002\u5728\u4e0b\u9762\u7684\u4f8b\u5b50\uff0c\u6211\u5011\u5c07 ",(0,n.kt)("inlineCode",{parentName:"p"},"greeting")," \u548c ",(0,n.kt)("inlineCode",{parentName:"p"},"name")," \u5169\u500b\u8b8a\u6578\u4fdd\u5b58\u5728 URL \u4e2d\u3002"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"https://our-app.com?greeting=hi&name=john\n")),(0,n.kt)("h2",{id:"react-router---usesearchparams"},"React Router - ",(0,n.kt)("inlineCode",{parentName:"h2"},"useSearchParams")),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://reactrouter.com/en/main"},"React Router")," \u63d0\u4f9b\u4e86 ",(0,n.kt)("inlineCode",{parentName:"p"},"useSearchParams"),"\uff0c\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u8b93\u6211\u5011\u4f7f\u7528 ",(0,n.kt)("inlineCode",{parentName:"p"},"URLSearchParams")," \u4f86\u7ba1\u7406\u4e26\u5206\u4eab\u72c0\u614b\u3002"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},'import { useSearchParams } from "react-router-dom";\nconst [searchParams, setSearchParams] = useSearchParams();\n\n// will set URL like: https://our-app.com?greeting=bonjour\n// this value will feed through to anything driven by the URL\nsetSearchParams({ greeting: "bonjour" });\n\n// this will be "bonjour"\nconst greeting = searchParams.get("greeting");\n')),(0,n.kt)("h2",{id:"usesearchparamsstate"},(0,n.kt)("inlineCode",{parentName:"h2"},"useSearchParamsState")),(0,n.kt)("p",null,"\u6211\u5011\u53ef\u4ee5\u9032\u4e00\u6b65\u5c07 ",(0,n.kt)("inlineCode",{parentName:"p"},"useSearchParams")," \u5c01\u88dd\u6210 ",(0,n.kt)("inlineCode",{parentName:"p"},"useSearchParamsState"),"\uff0c\u8b93\u6211\u5011\u5728\u6539\u8b8a\u55ae\u500b\u53c3\u6578\u6642\uff0c\u4e0d\u6703\u4e1f\u5931\u5176\u4ed6\u53c3\u6578\u3002\u8fd4\u56de\u7684 ",(0,n.kt)("inlineCode",{parentName:"p"},"setSearchParamsState")," \u51fd\u6578\uff0c\u53ef\u4ee5\u63a5\u53d7\u4e00\u500b\u65b0\u7684\u503c\uff0c\u4e26\u4e14\u900f\u904e ",(0,n.kt)("inlineCode",{parentName:"p"},"Object.assign")," \u4ee5\u53ca ",(0,n.kt)("inlineCode",{parentName:"p"},"reduce")," \u7684\u6280\u5de7\uff0c\u5c07\u65b0\u7684\u503c\u8207\u820a\u7684\u503c\u5408\u4f75\u3002"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-tsx"},'import { useSearchParams } from "react-router-dom";\n\nexport function useSearchParamsState(\n  searchParamName: string,\n  defaultValue: string\n): readonly [\n  searchParamsState: string,\n  setSearchParamsState: (newState: string) => void\n] {\n  const [searchParams, setSearchParams] = useSearchParams();\n\n  const acquiredSearchParam = searchParams.get(searchParamName);\n  const searchParamsState = acquiredSearchParam ?? defaultValue;\n\n  // highlight-start\n  const setSearchParamsState = (newState: string) => {\n    const next = Object.assign(\n      {},\n      [...searchParams.entries()].reduce(\n        (o, [key, value]) => ({ ...o, [key]: value }),\n        {}\n      ),\n      { [searchParamName]: newState }\n    );\n    setSearchParams(next);\n  };\n  // highlight-end\n  return [searchParamsState, setSearchParamsState];\n}\n')),(0,n.kt)("p",null,"\u7528\u6cd5\u50cf\u4e0b\u9762\u9019\u6a23\uff0c\u6211\u5011\u50b3\u5165\u4e00\u500b ",(0,n.kt)("inlineCode",{parentName:"p"},"searchParamName")," \u548c ",(0,n.kt)("inlineCode",{parentName:"p"},"defaultValue"),"\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u4e00\u500b\u985e\u4f3c ",(0,n.kt)("inlineCode",{parentName:"p"},"useState")," \u7684 API\u3002"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-tsx"},'const [greeting, setGreeting] = useSearchParamsState("greeting", "hello");\n')),(0,n.kt)("admonition",{type:"note"},(0,n.kt)("p",{parentName:"admonition"},(0,n.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Object/assign"},"\u66f4\u6df1\u5165\u4e86\u89e3 Object.assign"),"\uff0c\u9019\u88e1\u63d0\u4f9b\u4e00\u500b\u7c21\u55ae\u7684\u7bc4\u4f8b\uff1a"),(0,n.kt)("pre",{parentName:"admonition"},(0,n.kt)("code",{parentName:"pre",className:"language-js"},"var o1 = { a: 1, b: 1 };\nvar o2 = { b: 2 };\nvar o3 = { c: 3 };\n\nvar obj = Object.assign(o1, o2, o3);\nconsole.log(obj); // { a: 1, b: 2, c: 3 }\nconsole.log(o1); // { a: 1, b: 2, c: 3 }, \u653e\u5728\u7b2c\u4e00\u500b\u7684\u7269\u4ef6\u672c\u8eab\u4e5f\u6703\u88ab\u6539\u8b8a\u3002\n"))),(0,n.kt)("h2",{id:"persisting-query-across-pages"},"Persisting query across pages"),(0,n.kt)("p",null,"\u53ea\u6709 ",(0,n.kt)("inlineCode",{parentName:"p"},"useSearchParamsState")," \u662f\u4e0d\u8db3\u4ee5\u5728\u9801\u9762\u4e4b\u9593\u50b3\u905e\u53c3\u6578\u7684\u3002\u70ba\u4e86\u505a\u5230\u9019\u4e00\u9ede\uff0c\u6211\u5011\u9700\u8981\u4f7f\u7528 ",(0,n.kt)("inlineCode",{parentName:"p"},"useLocation")," \u4f86\u7372\u53d6\u7576\u524d\u7684\u53c3\u6578\uff0c\u4e26\u5c07\u5b83\u5011\u50b3\u905e\u7d66\u5176\u4ed6\u9023\u7d50\u3002"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-tsx"},'import { useLocation } from "react-router-dom";\n\nconst [location] = useLocation();\nreturn (<Link to={`/my-page${location.search}`}>Page</>)\n')))}m.isMDXComponent=!0}}]);