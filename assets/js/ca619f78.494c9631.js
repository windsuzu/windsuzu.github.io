"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[6510],{3905:(e,r,n)=>{n.d(r,{Zo:()=>d,kt:()=>m});var t=n(7294);function a(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function o(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function i(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?o(Object(n),!0).forEach((function(r){a(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function c(e,r){if(null==e)return{};var n,t,a=function(e,r){if(null==e)return{};var n,t,a={},o=Object.keys(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||(a[n]=e[n]);return a}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=t.createContext({}),s=function(e){var r=t.useContext(l),n=r;return e&&(n="function"==typeof e?e(r):i(i({},r),e)),n},d=function(e){var r=s(e.components);return t.createElement(l.Provider,{value:r},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var r=e.children;return t.createElement(t.Fragment,{},r)}},h=t.forwardRef((function(e,r){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,d=c(e,["components","mdxType","originalType","parentName"]),p=s(n),h=a,m=p["".concat(l,".").concat(h)]||p[h]||u[h]||o;return n?t.createElement(m,i(i({ref:r},d),{},{components:n})):t.createElement(m,i({ref:r},d))}));function m(e,r){var n=arguments,a=r&&r.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=h;var c={};for(var l in r)hasOwnProperty.call(r,l)&&(c[l]=r[l]);c.originalType=e,c[p]="string"==typeof e?e:a,i[1]=c;for(var s=2;s<o;s++)i[s]=n[s];return t.createElement.apply(null,i)}return t.createElement.apply(null,n)}h.displayName="MDXCreateElement"},7702:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>c,toc:()=>s});var t=n(7462),a=(n(7294),n(3905));const o={id:"error-boundary-guide",title:"ErrorBoundary Guide",description:"\u5728 React \u4e2d\uff0c\u6211\u5011\u7121\u6cd5\u5c07\u6574\u500b useEffect \u6216\u5b50\u5143\u7d20\u88dd\u5728 try/catch \u4f86\u6355\u7372\u932f\u8aa4\uff0c\u4f46\u6211\u5011\u53ef\u4ee5\u4f7f\u7528 ErrorBoundary \u4f86\u5be6\u73fe\u9019\u4e00\u9ede\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cErrorBoundary \u4e5f\u6709\u4e00\u4e9b\u9650\u5236\uff0c\u4f8b\u5982\u7121\u6cd5\u6355\u7372\u975e\u540c\u6b65\u932f\u8aa4\u6216\u4e8b\u4ef6\u8655\u7406\u4e2d\u7684\u932f\u8aa4\u3002\u4f46\u6211\u5011\u53ef\u4ee5\u5728 catch \u5340\u584a\u4e2d\u5f37\u5236\u5c07 React \u91cd\u65b0\u6e32\u67d3\uff0c\u7136\u5f8c\u628a\u932f\u8aa4\u4e1f\u56de\u91cd\u65b0\u6e32\u67d3\u7684\u751f\u547d\u9031\u671f\u4f86\u89e3\u6c7a\u9019\u500b\u554f\u984c\u3002",sidebar_label:"\ud83d\udfe9 ErrorBoundary Guide",hide_title:!0,hide_table_of_contents:!1,tags:["react","js","error-boundary"],draft:!1,last_updated:new Date("2023-02-28T00:00:00.000Z")},i=void 0,c={unversionedId:"frontend/react-next/error-boundary-guide",id:"frontend/react-next/error-boundary-guide",title:"ErrorBoundary Guide",description:"\u5728 React \u4e2d\uff0c\u6211\u5011\u7121\u6cd5\u5c07\u6574\u500b useEffect \u6216\u5b50\u5143\u7d20\u88dd\u5728 try/catch \u4f86\u6355\u7372\u932f\u8aa4\uff0c\u4f46\u6211\u5011\u53ef\u4ee5\u4f7f\u7528 ErrorBoundary \u4f86\u5be6\u73fe\u9019\u4e00\u9ede\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cErrorBoundary \u4e5f\u6709\u4e00\u4e9b\u9650\u5236\uff0c\u4f8b\u5982\u7121\u6cd5\u6355\u7372\u975e\u540c\u6b65\u932f\u8aa4\u6216\u4e8b\u4ef6\u8655\u7406\u4e2d\u7684\u932f\u8aa4\u3002\u4f46\u6211\u5011\u53ef\u4ee5\u5728 catch \u5340\u584a\u4e2d\u5f37\u5236\u5c07 React \u91cd\u65b0\u6e32\u67d3\uff0c\u7136\u5f8c\u628a\u932f\u8aa4\u4e1f\u56de\u91cd\u65b0\u6e32\u67d3\u7684\u751f\u547d\u9031\u671f\u4f86\u89e3\u6c7a\u9019\u500b\u554f\u984c\u3002",source:"@site/docs/frontend/react-next/2023-02-28-error-boundary-guide.mdx",sourceDirName:"frontend/react-next",slug:"/frontend/react-next/error-boundary-guide",permalink:"/frontend/react-next/error-boundary-guide",draft:!1,editUrl:"https://github.com/windsuzu/windsuzu.github.io/tree/master/docs/frontend/react-next/2023-02-28-error-boundary-guide.mdx",tags:[{label:"react",permalink:"/tags/react"},{label:"js",permalink:"/tags/js"},{label:"error-boundary",permalink:"/tags/error-boundary"}],version:"current",lastUpdatedAt:1680944961,formattedLastUpdatedAt:"2023\u5e744\u67088\u65e5",frontMatter:{id:"error-boundary-guide",title:"ErrorBoundary Guide",description:"\u5728 React \u4e2d\uff0c\u6211\u5011\u7121\u6cd5\u5c07\u6574\u500b useEffect \u6216\u5b50\u5143\u7d20\u88dd\u5728 try/catch \u4f86\u6355\u7372\u932f\u8aa4\uff0c\u4f46\u6211\u5011\u53ef\u4ee5\u4f7f\u7528 ErrorBoundary \u4f86\u5be6\u73fe\u9019\u4e00\u9ede\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cErrorBoundary \u4e5f\u6709\u4e00\u4e9b\u9650\u5236\uff0c\u4f8b\u5982\u7121\u6cd5\u6355\u7372\u975e\u540c\u6b65\u932f\u8aa4\u6216\u4e8b\u4ef6\u8655\u7406\u4e2d\u7684\u932f\u8aa4\u3002\u4f46\u6211\u5011\u53ef\u4ee5\u5728 catch \u5340\u584a\u4e2d\u5f37\u5236\u5c07 React \u91cd\u65b0\u6e32\u67d3\uff0c\u7136\u5f8c\u628a\u932f\u8aa4\u4e1f\u56de\u91cd\u65b0\u6e32\u67d3\u7684\u751f\u547d\u9031\u671f\u4f86\u89e3\u6c7a\u9019\u500b\u554f\u984c\u3002",sidebar_label:"\ud83d\udfe9 ErrorBoundary Guide",hide_title:!0,hide_table_of_contents:!1,tags:["react","js","error-boundary"],draft:!1,last_updated:"2023-02-28T00:00:00.000Z"},sidebar:"react-next",previous:{title:"\ud83d\udfe8 useState vs useSignal",permalink:"/frontend/react-next/usestate-vs-usesignal"},next:{title:"\ud83d\udfe9 Is useState Asynchronous?",permalink:"/frontend/react-next/is-usestate-asynchronous"}},l={},s=[{value:"Why do we need to catch errors in React?",id:"why-do-we-need-to-catch-errors-in-react",level:2},{value:"Review: Catching Errors in JavaScript",id:"review-catching-errors-in-javascript",level:2},{value:"Problems of <code>try/catch</code> in React",id:"problems-of-trycatch-in-react",level:2},{value:"1. Catch errors in <code>useEffect</code>",id:"1-catch-errors-in-useeffect",level:3},{value:"2. Catch errors in <code>children</code>",id:"2-catch-errors-in-children",level:3},{value:"3. Catch errors in <code>render</code> and Change state",id:"3-catch-errors-in-render-and-change-state",level:3},{value:"ErrorBoundary in React",id:"errorboundary-in-react",level:2},{value:"ErrorBoundary with Asynchronous Error",id:"errorboundary-with-asynchronous-error",level:2},{value:"Conclusion",id:"conclusion",level:2}],d={toc:s};function p(e){let{components:r,...n}=e;return(0,a.kt)("wrapper",(0,t.Z)({},d,n,{components:r,mdxType:"MDXLayout"}),(0,a.kt)("profile",{title:"How to handle errors in React: full guide",url:"https://www.developerway.com/posts/how-to-handle-errors-in-react",author:"NADIA MAKAREVICH",level:"beginner",category:["react/next","js/ts"]}),(0,a.kt)("p",null,"\u672c\u6587\u4ecb\u7d39\u4e86 React \u4e2d\u8655\u7406\u932f\u8aa4\u7684\u5169\u7a2e\u65b9\u5f0f\uff1a\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"try/catch")," \u548c ",(0,a.kt)("inlineCode",{parentName:"p"},"ErrorBoundary"),"\uff0c\u4ee5\u53ca\u5b83\u5011\u5404\u81ea\u7684\u9650\u5236\u3002\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"try/catch")," \u6642\uff0c\u5b83\u7121\u6cd5\u6355\u7372 ",(0,a.kt)("inlineCode",{parentName:"p"},"hooks")," \u548c\u5b50\u7d44\u4ef6\u4e2d\u7684\u932f\u8aa4\u3002\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"ErrorBoundary")," \u6642\uff0c\u5b83\u7121\u6cd5\u6355\u7372",(0,a.kt)("strong",{parentName:"p"},"\u7570\u6b65\u4ee3\u78bc (async code)")," \u548c",(0,a.kt)("strong",{parentName:"p"},"\u4e8b\u4ef6\u8655\u7406\u7a0b\u5e8f (event handler)")," \u4e2d\u7684\u932f\u8aa4\u3002\u4f46\u662f\uff0c\u53ef\u4ee5\u901a\u904e\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"try/catch")," \u4e2d\u6355\u7372\u932f\u8aa4\uff0c\u7136\u5f8c\u5c07\u932f\u8aa4\u91cd\u65b0\u629b\u51fa\u5230 React \u7684\u751f\u547d\u9031\u671f\u4e2d\uff0c\u4f7f ",(0,a.kt)("inlineCode",{parentName:"p"},"ErrorBoundary")," \u80fd\u5920\u6355\u7372\u9019\u4e9b\u932f\u8aa4\u3002"),(0,a.kt)("h2",{id:"why-do-we-need-to-catch-errors-in-react"},"Why do we need to catch errors in React?"),(0,a.kt)("p",null,"\u70ba\u4ec0\u9ebc\u6211\u5011\u9700\u8981\u5728 React \u4e2d\u6355\u7372\u932f\u8aa4\u5462\uff1f\u7b54\u6848\u662f\u56e0\u70ba\u5f9e React 16 \u958b\u59cb\uff0c\u5982\u679c\u6c92\u6709\u6355\u7372\u932f\u8aa4\uff0cReact \u6703\u76f4\u63a5\u5728\u751f\u547d\u9031\u671f\u4e2d\u629b\u51fa\u932f\u8aa4\uff0c\u505c\u6b62\u6574\u500b\u61c9\u7528\u7a0b\u5e8f\uff0c\u4e26\u8df3\u51fa\u932f\u8aa4\u9801\u9762\u3002\u56e0\u6b64\uff0c\u5373\u4f7f\u932f\u8aa4\u767c\u751f\u5728 UI \u4e2d\u7684\u67d0\u500b\u4e0d\u91cd\u8981\u7684\u90e8\u5206\uff0c\u6216\u8005\u662f\u67d0\u500b\u4f60\u7121\u6cd5\u63a7\u5236\u7684\u7b2c\u4e09\u65b9\u5eab\u4e2d\uff0c\u5982\u679c\u6c92\u6709\u6355\u7372\u932f\u8aa4\uff0c\u6574\u500b\u9801\u9762\u90fd\u6703\u88ab\u92b7\u6bc0\uff0c\u4e26\u4e14\u5411\u4f7f\u7528\u8005\u986f\u793a\u932f\u8aa4\u9801\u9762\u3002"),(0,a.kt)("h2",{id:"review-catching-errors-in-javascript"},"Review: Catching Errors in JavaScript"),(0,a.kt)("p",null,"\u5728 JavaScript \u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"try/catch")," \u4f86\u6355\u7372\u932f\u8aa4\u3002\u5982\u679c\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"try")," \u4e2d\u7684\u4ee3\u78bc\u4e2d\u767c\u751f\u932f\u8aa4\uff0c\u5247\u53ef\u4ee5\u6355\u7372\u932f\u8aa4\uff0c\u4e26\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"catch")," \u4e2d\u8655\u7406\u932f\u8aa4\u3002\u9019\u500b\u65b9\u6cd5\u9069\u7528\u65bc\u540c\u6b65\u7a0b\u5f0f\u78bc\uff0c\u4e5f\u9069\u7528\u65bc\u975e\u540c\u6b65\u7a0b\u5f0f\u78bc\u3002\u6211\u5011\u4e5f\u53ef\u4ee5\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise.then()")," \u548c ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise.catch()")," \u4f86\u6355\u7372\u975e\u540c\u6b65\u7684\u932f\u8aa4\uff0c\u4f46\u9019\u7bc7\u6587\u7ae0\u4ee5 ",(0,a.kt)("inlineCode",{parentName:"p"},"try/catch")," \u70ba\u4e3b\u3002"),(0,a.kt)("div",{style:{columns:"20rem"}},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="Catch synchronous errors"',title:'"Catch',synchronous:!0,'errors"':!0},"try {\n  doSomethingWrong();\n} catch (error) {\n  // handle error\n}\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="Catch asynchronous errors"',title:'"Catch',asynchronous:!0,'errors"':!0},'try {\n  await fetch("/bla-bla");\n} catch (error) {\n  // handle error\n}\n'))),(0,a.kt)("h2",{id:"problems-of-trycatch-in-react"},"Problems of ",(0,a.kt)("inlineCode",{parentName:"h2"},"try/catch")," in React"),(0,a.kt)("p",null,"\u5728 React \u4e2d\uff0c\u6211\u5011\u53ef\u4ee5\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"try/catch")," \u4f86\u6355\u7372\u932f\u8aa4\u3002\u4f46\u662f\uff0c\u4ee5\u4e0b\u662f\u4e09\u7a2e\u932f\u8aa4\u7684\u4f7f\u7528\u65b9\u5f0f\uff1a"),(0,a.kt)("h3",{id:"1-catch-errors-in-useeffect"},"1. Catch errors in ",(0,a.kt)("inlineCode",{parentName:"h3"},"useEffect")),(0,a.kt)("p",null,"\u5c07 ",(0,a.kt)("inlineCode",{parentName:"p"},"useEffect")," \u6574\u500b\u653e\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"try/catch")," \u4e2d\u662f\u932f\u8aa4\u7684\u3002\u7531\u65bc ",(0,a.kt)("inlineCode",{parentName:"p"},"useEffect")," \u662f\u5728 render \u5f8c\u975e\u540c\u6b65\u57f7\u884c\uff0c\u6240\u4ee5\u5c0d\u65bc ",(0,a.kt)("inlineCode",{parentName:"p"},"try/catch")," \u4f86\u8aaa\u6c38\u9060\u90fd\u662f\u6210\u529f\u57f7\u884c\uff0c\u4e5f\u5c31\u6c38\u9060\u6293\u4e0d\u5230 ",(0,a.kt)("inlineCode",{parentName:"p"},"useEffect")," \u4e2d\u7684\u932f\u8aa4\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="Catch errors in hooks \u274c"',title:'"Catch',errors:!0,in:!0,hooks:!0,'\u274c"':!0},"const Component = () => {\n  try {\n    useEffect(() => {\n      doSomethingWrong();\n    }, []);\n  } catch (error) {\n    // never triggered\n  }\n  return <div />;\n};\n")),(0,a.kt)("h3",{id:"2-catch-errors-in-children"},"2. Catch errors in ",(0,a.kt)("inlineCode",{parentName:"h3"},"children")),(0,a.kt)("p",null,"\u5c07 ",(0,a.kt)("inlineCode",{parentName:"p"},"children")," \u6574\u500b\u653e\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"try/catch")," \u4e2d\u662f\u932f\u8aa4\u7684\u3002\u4e0d\u7ba1\u662f\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"try/catch")," \u4e2d\u5b9a\u7fa9 ",(0,a.kt)("inlineCode",{parentName:"p"},"children"),"\uff0c\u9084\u662f\u76f4\u63a5\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"try/catch")," \u4e2d\u8fd4\u56de ",(0,a.kt)("inlineCode",{parentName:"p"},"children"),"\uff0c\u90fd\u662f\u932f\u8aa4\u7684\u3002\u9019\u662f\u56e0\u70ba\u7576\u7a0b\u5f0f\u57f7\u884c\u5230 ",(0,a.kt)("inlineCode",{parentName:"p"},"<Child />")," \u6642\uff0c\u5b83\u4e26\u4e0d\u662f\u771f\u6b63\u7684\u6e32\u67d3\u5143\u4ef6\uff0c\u800c\u662f\u5275\u5efa\u4e86\u4e00\u500b\u5143\u4ef6\u5143\u7d20\u3002\u9019\u500b\u5143\u7d20\u53ea\u662f\u4e00\u500b\u5305\u542b\u5143\u4ef6\u985e\u578b\u548c\u5c6c\u6027\u7684\u5c0d\u8c61\uff0c\u800c\u4e14\u6703\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"try/catch")," \u57f7\u884c\u6210\u529f\u5f8c\uff0c\u5728 React \u4e2d\u88ab\u4f7f\u7528\uff0c\u8207 ",(0,a.kt)("inlineCode",{parentName:"p"},"useEffect")," \u7684\u60c5\u6cc1\u985e\u4f3c\uff0c\u6240\u4ee5\u4e5f\u662f\u7121\u6cd5\u6355\u7372\u932f\u8aa4\u7684\u3002"),(0,a.kt)("div",{style:{columns:"20rem"}},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="Catch errors in children \u274c"',title:'"Catch',errors:!0,in:!0,children:!0,'\u274c"':!0},"const Component = () => {\n  let child;\n\n  try {\n    child = <Child />;\n  } catch (e) {\n    // never triggered\n  }\n  return child;\n};\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="Catch errors in children \u274c"',title:'"Catch',errors:!0,in:!0,children:!0,'\u274c"':!0},"const Component = () => {\n  try {\n    return <Child />;\n  } catch (e) {\n    // never triggered\n  }\n};\n"))),(0,a.kt)("h3",{id:"3-catch-errors-in-render-and-change-state"},"3. Catch errors in ",(0,a.kt)("inlineCode",{parentName:"h3"},"render")," and Change state"),(0,a.kt)("p",null,"\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"render")," \u4e2d\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"try/catch")," \u4f86\u6355\u7372\u932f\u8aa4\uff0c\u4e26\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"catch")," \u4e2d\u6539\u8b8a ",(0,a.kt)("inlineCode",{parentName:"p"},"state"),"\uff0c\u9019\u662f\u932f\u8aa4\u7684\u3002\u9019\u662f\u56e0\u70ba ",(0,a.kt)("inlineCode",{parentName:"p"},"render")," \u662f\u540c\u6b65\u57f7\u884c\u7684\uff0c\u6240\u4ee5 ",(0,a.kt)("inlineCode",{parentName:"p"},"try/catch")," \u6703\u6355\u7372\u5230\u932f\u8aa4\uff0c\u4f46\u662f\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"catch")," \u4e2d\u6539\u8b8a ",(0,a.kt)("inlineCode",{parentName:"p"},"state")," \u6703\u5c0e\u81f4\u7121\u9650\u5faa\u74b0\uff0c\u56e0\u70ba ",(0,a.kt)("inlineCode",{parentName:"p"},"render")," \u6703\u518d\u6b21\u88ab\u8abf\u7528\uff0c\u9032\u800c\u518d\u6b21\u89f8\u767c ",(0,a.kt)("inlineCode",{parentName:"p"},"try/catch"),"\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="Change state in render \u274c"',title:'"Change',state:!0,in:!0,render:!0,'\u274c"':!0},"const Component = () => {\n  const [hasError, setHasError] = useState(false);\n\n  try {\n    doSomethingComplicated();\n  } catch (e) {\n    // will cause infinite loop\n    setHasError(true);\n  }\n};\n")),(0,a.kt)("h2",{id:"errorboundary-in-react"},"ErrorBoundary in React"),(0,a.kt)("p",null,"\u70ba\u4e86\u89e3\u6c7a\u4e0a\u8ff0\u554f\u984c\uff0cReact \u63d0\u4f9b\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"ErrorBoundary")," \u9019\u500b",(0,a.kt)("strong",{parentName:"p"},"\u300c\u6982\u5ff5\u300d")," \u4f86\u6355\u7372\u932f\u8aa4\u3002\u6211\u5011\u5fc5\u9808\u4f7f\u7528\u820a\u7248\u7684 class component \u81ea\u884c\u5be6\u73fe\u4e00\u500b ",(0,a.kt)("inlineCode",{parentName:"p"},"ErrorBoundary"),"\uff0c\u7136\u5f8c\u4f7f\u7528\u5b83\u4f86\u5305\u4f4f\u53ef\u80fd\u6703\u767c\u751f\u932f\u8aa4\u7684\u5143\u4ef6\u3002\u9019\u500b ",(0,a.kt)("inlineCode",{parentName:"p"},"ErrorBoundary")," \u5143\u4ef6\u5305\u542b\u4e86\u5e7e\u500b\u751f\u547d\u9031\u671f\u65b9\u6cd5\uff0c\u4f8b\u5982"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"constructor")," \u6703\u521d\u59cb\u5316\u4e00\u500b ",(0,a.kt)("inlineCode",{parentName:"li"},"state"),"\uff0c\u7528\u4f86\u5b58\u653e\u662f\u5426\u767c\u751f\u932f\u8aa4"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"static getDerivedStateFromError")," \u6703\u5728 ",(0,a.kt)("inlineCode",{parentName:"li"},"render")," \u4e2d\u767c\u751f\u932f\u8aa4\u6642\u88ab\u8abf\u7528\uff0c\u4e26\u5c07 ",(0,a.kt)("inlineCode",{parentName:"li"},"state")," \u4e2d\u7684 ",(0,a.kt)("inlineCode",{parentName:"li"},"hasError")," \u8a2d\u7f6e\u70ba ",(0,a.kt)("inlineCode",{parentName:"li"},"true"),"\uff0c\u6211\u5011\u5c31\u53ef\u4ee5\u6839\u64da ",(0,a.kt)("inlineCode",{parentName:"li"},"hasError")," \u4f86\u6e32\u67d3\u932f\u8aa4\u8a0a\u606f\u3002\u9019\u500b\u65b9\u6cd5\u662f\u7522\u751f ErrorBoundary \u7684\u5fc5\u8981\u65b9\u6cd5"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"componentDidCatch")," \u53ef\u4ee5\u5c07\u932f\u8aa4\u8a0a\u606f\u52a0\u4ee5\u5229\u7528\uff0c\u4f8b\u5982\u767c\u9001\u5230\u5f8c\u7aef\uff0c\u6216\u8005\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"li"},"Sentry")," \u4f86\u6355\u7372\u932f\u8aa4")),(0,a.kt)("p",null,"\u53e6\u5916\uff0c\u6211\u5011\u4e5f\u53ef\u4ee5\u81ea\u5b9a\u7fa9 ",(0,a.kt)("inlineCode",{parentName:"p"},"ErrorBoundary")," \u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"fallback"),"\uff0c\u9019\u500b ",(0,a.kt)("inlineCode",{parentName:"p"},"fallback")," \u6703\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"render")," \u4e2d\u767c\u751f\u932f\u8aa4\u6642\u88ab\u6e32\u67d3\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="ErrorBoundary Example" live noInline',title:'"ErrorBoundary','Example"':!0,live:!0,noInline:!0},'class ErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n    // initialize the error state\n    this.state = { hasError: false };\n  }\n\n  // if an error happened, set the state to true\n  static getDerivedStateFromError(error) {\n    return { hasError: true };\n  }\n\n  componentDidCatch(error, errorInfo) {\n    // send error to somewhere here\n    console.log(error, errorInfo);\n  }\n\n  render() {\n    // if error happened, return a fallback component\n    if (this.state.hasError) {\n      return this.props.fallback || <>Oh no! Something went wrong!</>;\n    }\n\n    return this.props.children;\n  }\n}\n\nconst ErrorComponent = () => {\n  const [counter, setCounter] = useState(0);\n\n  useEffect(() => {\n    if (counter > 0) throw new Error("error");\n  }, [counter]);\n\n  return (\n    <button onClick={() => setCounter((prev) => prev + 1)}>Click me</button>\n  );\n};\n\nrender(\n  <ErrorBoundary fallback={<>Wow it is broken!</>}>\n    <ErrorComponent />\n  </ErrorBoundary>\n);\n')),(0,a.kt)("h2",{id:"errorboundary-with-asynchronous-error"},"ErrorBoundary with Asynchronous Error"),(0,a.kt)("p",null,"\u4e0a\u9762\u6211\u5011\u6240\u5beb\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"ErrorBoundary")," \u6709\u4e00\u4e9b\u9650\u5236\uff0c\u4f8b\u5982\u6211\u5011\u4e0d\u80fd\u900f\u904e ",(0,a.kt)("inlineCode",{parentName:"p"},"ErrorBoundary")," \u4f86\u6355\u7372\u975e\u540c\u6b65\u7684\u932f\u8aa4\uff0c\u4f8b\u5982 ",(0,a.kt)("inlineCode",{parentName:"p"},"setTimeout"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"Promise"),"\uff1b\u6211\u5011\u4e5f\u7121\u6cd5\u900f\u904e ",(0,a.kt)("inlineCode",{parentName:"p"},"ErrorBoundary")," \u4f86\u6355\u7372 Event Handler, Callback \u4e2d\u7684\u932f\u8aa4\uff0c\u4f8b\u5982 ",(0,a.kt)("inlineCode",{parentName:"p"},"onClick"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"onSubmit"),"\u3002"),(0,a.kt)("div",{style:{columns:"20rem"}},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="can\'t catch errors from event handler \u274c"',title:"\"can't",catch:!0,errors:!0,from:!0,event:!0,handler:!0,'\u274c"':!0},'const onClick = () => {\n  // this error will disappear into the void\n  throw new Error("Hulk smash!");\n};\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="can\'t catch errors from async function \u274c"',title:"\"can't",catch:!0,errors:!0,from:!0,async:!0,function:!0,'\u274c"':!0},'useEffect(() => {\n  //the error will also disappear\n  fetch("/bla");\n}, []);\n'))),(0,a.kt)("p",null,"\u4e0d\u904e\u5728 ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/facebook/react/issues/14981#issuecomment-468460187"},"Throwing Error from hook not caught in error boundary \xb7 Issue #14981 \xb7 facebook/react"),". \u4e2d\uff0c",(0,a.kt)("a",{parentName:"p",href:"https://twitter.com/dan_abramov"},"Dan Abramov")," \u63d0\u4f9b\u4e86\u4e00\u500b\u89e3\u6c7a\u65b9\u6848\u3002\u6211\u5011\u53ef\u4ee5\u5148\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"try/catch")," \u4e2d\u6355\u7372\u932f\u8aa4\uff0c\u7136\u5f8c\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"catch")," \u4e2d\u89f8\u767c\u4e00\u6b21 React \u91cd\u65b0\u6e32\u67d3\uff0c\u6700\u5f8c\u518d\u5c07\u932f\u8aa4\u4e1f\u56de\u91cd\u65b0\u6e32\u67d3\u7684\u751f\u547d\u9031\u671f\u4e2d\u3002\u9019\u6a23 ",(0,a.kt)("inlineCode",{parentName:"p"},"ErrorBoundary")," \u5c31\u53ef\u4ee5\u50cf\u5176\u4ed6\u932f\u8aa4\u4e00\u6a23\u6355\u7372\u5b83\u5011\u3002\u7531\u65bc ",(0,a.kt)("inlineCode",{parentName:"p"},"useState")," \u7684\u66f4\u65b0\u662f\u89f8\u767c\u91cd\u65b0\u6e32\u67d3\u7684\u65b9\u5f0f\uff0c\u800c ",(0,a.kt)("inlineCode",{parentName:"p"},"useState")," \u7684\u8a2d\u7f6e\u51fd\u6578\u53ef\u4ee5\u63a5\u53d7\u4e00\u500b\u66f4\u65b0\u51fd\u6578\u4f5c\u70ba\u53c3\u6578\uff0c\u6240\u4ee5\u6211\u5011\u53ef\u4ee5\u4f7f\u7528\u9019\u500b\u66f4\u65b0\u51fd\u6578\u4f86\u91cd\u65b0\u4e1f\u51fa\u932f\u8aa4\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="ErrorBoundary Example" live noInline',title:'"ErrorBoundary','Example"':!0,live:!0,noInline:!0},'// this is a custom hook to throw error in async function\nconst useThrowAsyncError = () => {\n  const [state, setState] = useState();\n  return (error) => {\n    setState(() => {\n      throw error;\n    });\n  };\n};\n\nclass ErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { hasError: false };\n  }\n\n  static getDerivedStateFromError(error) {\n    return { hasError: true };\n  }\n\n  render() {\n    if (this.state.hasError) {\n      return <>Oh no! Something went wrong!</>;\n    }\n    return this.props.children;\n  }\n}\n\nconst ErrorComponent = () => {\n  const throwAsyncError = useThrowAsyncError();\n  return (\n    <button\n      onClick={() => {\n        try {\n          throw new Error("error");\n        } catch (e) {\n          // this will trigger React to re-render\n          // and throw the error again\n          throwAsyncError(e);\n        }\n      }}\n    >\n      Click me\n    </button>\n  );\n};\n\nrender(\n  <ErrorBoundary fallback={<>Wow it is broken!</>}>\n    <ErrorComponent />\n  </ErrorBoundary>\n);\n')),(0,a.kt)("h2",{id:"conclusion"},"Conclusion"),(0,a.kt)("p",null,"\u5728 React \u4e2d\uff0c\u6211\u5011\u7121\u6cd5\u900f\u904e ",(0,a.kt)("inlineCode",{parentName:"p"},"try/catch")," \u5305\u4f4f\u6574\u500b ",(0,a.kt)("inlineCode",{parentName:"p"},"useEffect")," \u6216\u662f\u5b50\u5143\u4ef6 ",(0,a.kt)("inlineCode",{parentName:"p"},"children")," \u4f86\u6355\u7372\u932f\u8aa4\uff0c\u4f46\u6211\u5011\u53ef\u4ee5\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"ErrorBoundary")," \u4f86\u9054\u6210\u3002\u4e0d\u904e ",(0,a.kt)("inlineCode",{parentName:"p"},"ErrorBoundary")," \u4e5f\u6709\u4e00\u4e9b\u9650\u5236\uff0c\u4f8b\u5982\u5b83\u7121\u6cd5\u6355\u7372\u975e\u540c\u6b65\u7684\u932f\u8aa4\uff0c\u4f8b\u5982 ",(0,a.kt)("inlineCode",{parentName:"p"},"setTimeout"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"Promise"),"\uff1b\u5b83\u4e5f\u7121\u6cd5\u6355\u7372 Event Handler, Callback \u4e2d\u7684\u932f\u8aa4\uff0c\u4f8b\u5982 ",(0,a.kt)("inlineCode",{parentName:"p"},"onClick"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"onSubmit"),"\u3002\u4e0d\u904e\u6211\u5011\u53ef\u4ee5\u4f7f\u7528\u4e00\u500b\u81ea\u5b9a\u7fa9\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"useThrowAsyncError")," \u4f86\u89e3\u6c7a\u9019\u500b\u554f\u984c\u3002\u6211\u5011\u53ef\u4ee5\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"catch")," \u4e2d\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"useThrowAsyncError")," \u5f37\u5236\u89f8\u767c React \u91cd\u65b0\u6e32\u67d3\uff0c\u6700\u5f8c\u518d\u5c07\u932f\u8aa4\u4e1f\u56de\u91cd\u65b0\u6e32\u67d3\u7684\u751f\u547d\u9031\u671f\u4e2d\u3002"),(0,a.kt)("p",null,"\u53e6\u5916\uff0c\u6211\u5011\u4e5f\u53ef\u4ee5\u8003\u616e\u4f7f\u7528 ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/bvaughn/react-error-boundary"},"bvaughn/react-error-boundary")," \u9019\u500b\u7b2c\u4e09\u65b9\u5957\u4ef6\u4f86\u89e3\u6c7a\u9019\u500b\u554f\u984c\u3002\u9019\u500b\u5957\u4ef6\u63d0\u4f9b\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"<ErrorBoundary>")," \u4ee5\u53ca ",(0,a.kt)("inlineCode",{parentName:"p"},"useErrorHandler"),"\uff0c\u8b93\u6211\u5011\u66f4\u65b9\u4fbf\u7684\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"ErrorBoundary")," \u7684\u65b9\u5f0f\u6355\u6349\u932f\u8aa4\u3002"))}p.isMDXComponent=!0}}]);